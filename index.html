<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Himachal Explorer ‚Äî New Index (Ultra Pro)</title>

  <!-- Leaflet (Map without API key) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Optional: Firebase (works if you fill config + enable RTDB rules) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>

  <style>
    :root{
      --bg0:#05070d;
      --bg1:#070b15;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --r:18px; --r2:26px;
      --a:#67e8f9; /* cyan */
      --b:#a78bfa; /* violet */
      --c:#34d399; /* green */
      --d:#ffcf5a; /* amber */
      --e:#ff6b6b; /* red */
      --max:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1200px 700px at 12% 10%, rgba(103,232,249,.18), transparent 55%),
        radial-gradient(1000px 700px at 82% 18%, rgba(167,139,250,.17), transparent 56%),
        radial-gradient(1000px 700px at 52% 92%, rgba(52,211,153,.12), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:var(--max); margin:0 auto; padding:22px 16px 42px}
    .topbar{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(5,7,13,.78), rgba(5,7,13,.35));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .topbar .inner{
      max-width:var(--max);
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; min-width:220px;
    }
    .logo{
      width:40px; height:40px; border-radius:14px;
      background:
        radial-gradient(12px 12px at 28% 28%, rgba(255,255,255,.24), transparent 55%),
        linear-gradient(135deg, rgba(103,232,249,.95), rgba(167,139,250,.92));
      box-shadow: 0 12px 30px rgba(103,232,249,.08);
      border:1px solid rgba(255,255,255,.18);
    }
    .brand h1{
      font-size:14px; margin:0; letter-spacing:.2px;
      line-height:1.1;
    }
    .brand small{display:block; color:var(--muted); font-weight:500; margin-top:2px}
    .nav{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      transition:.2s ease;
      font-weight:700; font-size:12px;
    }
    .pill:hover{transform: translateY(-1px); background:rgba(255,255,255,.08)}
    .pill .dot{
      width:8px; height:8px; border-radius:50%;
      background: linear-gradient(135deg, var(--a), var(--b));
      box-shadow: 0 0 0 4px rgba(103,232,249,.12);
    }
    .btn{
      appearance:none; border:0; cursor:pointer;
      color:var(--text);
      padding:11px 14px; border-radius:14px;
      background: linear-gradient(135deg, rgba(103,232,249,.18), rgba(167,139,250,.14));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      font-weight:800; font-size:12px;
      transition:.18s ease;
      display:inline-flex; align-items:center; gap:10px;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn.ghost{
      background:rgba(255,255,255,.06);
      box-shadow:none;
    }

    /* HERO */
    .hero{
      margin-top:16px;
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap:14px;
      align-items:stretch;
    }
    .heroMain{
      position:relative;
      overflow:hidden;
      border-radius: var(--r2);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      min-height: 360px;
      background:
        linear-gradient(120deg, rgba(0,0,0,.55), rgba(0,0,0,.10)),
        url("https://images.unsplash.com/photo-1548013146-72479768bada?auto=format&fit=crop&w=1800&q=75") center/cover no-repeat;
    }
    .heroMain::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(700px 420px at 20% 35%, rgba(103,232,249,.14), transparent 62%),
        radial-gradient(700px 420px at 78% 30%, rgba(167,139,250,.16), transparent 62%);
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .heroInner{
      position:relative;
      padding:22px;
      display:flex;
      flex-direction:column;
      height:100%;
      justify-content:space-between;
      gap:14px;
    }
    .heroTitle{
      margin:0;
      font-size: clamp(24px, 3vw, 40px);
      letter-spacing:-.4px;
      line-height:1.05;
    }
    .heroSub{
      margin:10px 0 0 0;
      color:rgba(255,255,255,.80);
      max-width:64ch;
      font-weight:600;
    }
    .heroChips{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;
    }
    .chip{
      padding:9px 11px;
      border-radius:999px;
      background: rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.16);
      font-size:12px; font-weight:800;
      color:rgba(255,255,255,.88);
    }
    .chip i{
      font-style:normal;
      padding:2px 8px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      margin-right:8px;
    }

    /* Finder */
    .finder{
      position:relative;
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr 170px 170px 160px;
      gap:10px;
      align-items:center;
    }
    .field{
      display:flex; flex-direction:column; gap:6px;
    }
    label{font-size:11px; color:var(--muted); font-weight:800; letter-spacing:.25px}
    .input, .select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      outline:none;
      font-weight:700;
    }
    .input::placeholder{color:rgba(255,255,255,.45)}
    .select{cursor:pointer}
    .heroActions{
      display:flex; gap:10px; flex-wrap:wrap;
    }

    /* Right panel */
    .heroSide{
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .panel{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--r2);
      box-shadow: 0 16px 60px rgba(0,0,0,.38);
      overflow:hidden;
    }
    .panelHead{
      padding:14px 14px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.06), transparent);
    }
    .panelHead h3{margin:0; font-size:13px}
    .panelHead small{color:var(--muted); font-weight:700}
    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      padding:14px;
    }
    .stat{
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding:12px;
      min-height:72px;
    }
    .stat b{display:block; font-size:18px}
    .stat span{color:var(--muted); font-weight:700; font-size:12px}
    .spark{
      margin-top:10px;
      height:8px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
    }
    .spark > i{
      display:block; height:100%;
      width:55%;
      background: linear-gradient(90deg, rgba(103,232,249,.95), rgba(167,139,250,.95));
      border-radius:999px;
    }
    .quickLinks{
      padding:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .qcard{
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      transition:.2s ease;
      cursor:pointer;
    }
    .qcard:hover{transform: translateY(-1px); background: rgba(255,255,255,.07)}
    .qcard b{display:block; font-size:12px}
    .qcard p{margin:6px 0 0; color:var(--muted); font-weight:650; font-size:12px; line-height:1.35}

    /* Sections */
    .section{
      margin-top:18px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    .sectionTitle{
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
      margin:8px 0 0;
    }
    .sectionTitle h2{margin:0; font-size:16px}
    .sectionTitle p{margin:0; color:var(--muted); font-weight:700; font-size:12px}

    /* District grid */
    .districts{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:10px;
    }
    .dItem{
      position:relative;
      border-radius:18px;
      padding:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      overflow:hidden;
      transition:.18s ease;
      min-height:86px;
    }
    .dItem:hover{transform: translateY(-2px); background: rgba(255,255,255,.08)}
    .dItem::after{
      content:"";
      position:absolute; inset:-40px -40px auto auto;
      width:120px; height:120px;
      background: radial-gradient(circle at 30% 30%, rgba(103,232,249,.25), transparent 55%);
      transform: rotate(18deg);
      pointer-events:none;
    }
    .dItem b{display:block; font-size:13px}
    .dMeta{
      margin-top:8px;
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .tag{
      font-size:11px; font-weight:800;
      padding:6px 9px;
      border-radius:999px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      color:rgba(255,255,255,.80);
    }

    /* Results + Map */
    .grid2{
      display:grid;
      grid-template-columns: .95fr 1.05fr;
      gap:14px;
      align-items:stretch;
    }
    .results{
      min-height:420px;
      display:flex;
      flex-direction:column;
    }
    .list{
      padding:14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      overflow:auto;
      max-height: 520px;
    }
    .place{
      display:grid;
      grid-template-columns: 92px 1fr;
      gap:12px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      transition:.18s ease;
    }
    .place:hover{transform: translateY(-1px); background: rgba(255,255,255,.08)}
    .thumb{
      width:92px; height:72px;
      border-radius:16px;
      background:
        linear-gradient(135deg, rgba(103,232,249,.12), rgba(167,139,250,.10)),
        url("https://images.unsplash.com/photo-1524492412937-b28074a5d7da?auto=format&fit=crop&w=800&q=60") center/cover no-repeat;
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      position:relative;
    }
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .pTitle{margin:0; font-size:13px}
    .pSub{margin:6px 0 0; color:var(--muted); font-weight:700; font-size:12px; line-height:1.35}
    .pBadges{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap}
    .badge{
      font-size:11px; font-weight:850;
      padding:6px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .mapBox{min-height:420px}
    #map{
      width:100%; height:100%;
      border-radius: var(--r2);
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      box-shadow: var(--shadow);
    }

    /* Drawer */
    .drawerWrap{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:14px;
      z-index:50;
    }
    .drawer{
      width:min(980px, 100%);
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,12,20,.86);
      backdrop-filter: blur(14px);
      box-shadow: 0 30px 120px rgba(0,0,0,.65);
      overflow:hidden;
      max-height: 86vh;
      display:flex;
      flex-direction:column;
    }
    .drawerTop{
      padding:14px 14px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .drawerTop h3{margin:0; font-size:14px}
    .drawerBody{
      padding:14px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      overflow:auto;
    }
    .gallery{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .gImg{
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      overflow:hidden;
      aspect-ratio: 4/3;
    }
    .gImg img{width:100%; height:100%; object-fit:cover; display:block}
    .infoCard{
      border-radius:22px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .infoCard p{margin:0; color:var(--muted); font-weight:650; line-height:1.45; font-size:12px}
    .row{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    .row .btn{flex:1}
    .closeX{
      width:42px; height:42px; border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      color:var(--text);
      font-weight:900;
    }

    /* AI Modal */
    .modalWrap{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index:60;
    }
    .modal{
      width:min(820px, 100%);
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,12,20,.90);
      backdrop-filter: blur(14px);
      box-shadow: 0 30px 120px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .modalHead{
      padding:14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalHead h3{margin:0; font-size:14px}
    .chat{
      padding:14px;
      display:flex; flex-direction:column; gap:10px;
      max-height: 62vh;
      overflow:auto;
    }
    .msg{
      max-width: 86%;
      padding:10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:var(--text);
      font-weight:650;
      line-height:1.45;
      font-size:12.5px;
    }
    .msg.me{
      margin-left:auto;
      background: linear-gradient(135deg, rgba(103,232,249,.14), rgba(167,139,250,.12));
    }
    .composer{
      padding:12px 14px 14px;
      display:flex;
      gap:10px;
      border-top:1px solid rgba(255,255,255,.10);
    }
    .composer input{
      flex:1;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      outline:none;
      font-weight:700;
    }

    /* Mobile */
    @media (max-width: 980px){
      .hero{grid-template-columns: 1fr}
      .finder{grid-template-columns: 1fr 1fr; }
      .finder .field:nth-child(1){grid-column:1 / -1}
      .finder .field:nth-child(4){grid-column:1 / -1}
      .grid2{grid-template-columns: 1fr}
      .districts{grid-template-columns: repeat(3, 1fr)}
      .drawerBody{grid-template-columns: 1fr}
      .gallery{grid-template-columns: repeat(2, 1fr)}
      .brand{min-width:auto}
    }
    @media (max-width: 520px){
      .districts{grid-template-columns: repeat(2, 1fr)}
      .heroMain{min-height: 340px}
      .list{max-height: 420px}
      .gallery{grid-template-columns: 1fr}
    }
  </style>
</head>

<body>
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="inner">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>Himachal Explorer</h1>
          <small>Find places ‚Ä¢ build routes ‚Ä¢ get packages</small>
        </div>
      </div>

      <div class="nav">
        <a class="pill" href="#districts"><span class="dot"></span>Districts</a>
        <a class="pill" href="#explore"><span class="dot"></span>Explore</a>
        <button class="btn ghost" id="openAI">AI Planner</button>
        <button class="btn" id="openAdmin" title="Optional">Admin</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- HERO -->
    <section class="hero" aria-label="hero">
      <div class="heroMain">
        <div class="heroInner">
          <div>
            <h2 class="heroTitle">Make your Himachal trip feel effortless.</h2>
            <p class="heroSub">
              Search places by <b>district</b>, <b>type</b> and <b>days</b>.
              Get a clean map view + quick packages. No messy layout.
            </p>

            <div class="heroChips">
              <div class="chip"><i>Smart</i>Only show what visitor needs</div>
              <div class="chip"><i>Fast</i>Map + cards + filters</div>
              <div class="chip"><i>Pro</i>AI trip suggestions</div>
            </div>

            <div class="finder" style="margin-top:16px">
              <div class="field">
                <label>Search (place / temple / lake / trek)</label>
                <input class="input" id="q" placeholder="Example: Triund, Manimahesh, Kufri, Chandratal..."/>
              </div>

              <div class="field">
                <label>District</label>
                <select class="select" id="district">
                  <option value="all">All</option>
                </select>
              </div>

              <div class="field">
                <label>Type</label>
                <select class="select" id="type">
                  <option value="all">All</option>
                  <option value="Destination">Destination</option>
                  <option value="Temple">Temple</option>
                  <option value="Lake">Lake</option>
                  <option value="Trek">Trek</option>
                  <option value="Hotel">Hotel</option>
                  <option value="Activity">Activity</option>
                </select>
              </div>

              <div class="field">
                <label>Trip Days</label>
                <select class="select" id="days">
                  <option value="0">Any</option>
                  <option value="1">1‚Äì2 days</option>
                  <option value="3">3‚Äì4 days</option>
                  <option value="5">5‚Äì7 days</option>
                  <option value="8">8‚Äì12 days</option>
                </select>
              </div>
            </div>

            <div class="heroActions" style="margin-top:12px">
              <button class="btn" id="apply">Explore Now</button>
              <button class="btn ghost" id="nearby">Show Nearby</button>
              <button class="btn ghost" id="reset">Reset</button>
            </div>
          </div>

          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap">
            <small style="color:rgba(255,255,255,.75); font-weight:700">
              Tip: Click a district card ‚Üí you‚Äôll instantly get filtered places.
            </small>
            <small id="status" style="color:rgba(255,255,255,.75); font-weight:800">Loading places‚Ä¶</small>
          </div>
        </div>
      </div>

      <div class="heroSide">
        <div class="panel">
          <div class="panelHead">
            <h3>Today‚Äôs vibe</h3>
            <small>clean + premium</small>
          </div>
          <div class="stats">
            <div class="stat">
              <b id="statPlaces">‚Äî</b>
              <span>Total places</span>
              <div class="spark"><i style="width:72%"></i></div>
            </div>
            <div class="stat">
              <b id="statDistricts">‚Äî</b>
              <span>Districts covered</span>
              <div class="spark"><i style="width:56%"></i></div>
            </div>
            <div class="stat">
              <b id="statTypes">‚Äî</b>
              <span>Types</span>
              <div class="spark"><i style="width:62%"></i></div>
            </div>
            <div class="stat">
              <b id="statShown">‚Äî</b>
              <span>Shown now</span>
              <div class="spark"><i style="width:44%"></i></div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panelHead">
            <h3>Quick Actions</h3>
            <small>one tap</small>
          </div>
          <div class="quickLinks">
            <div class="qcard" data-quick="Trek">
              <b>Top Treks</b><p>Triund, Prashar, Hampta‚Ä¶</p>
            </div>
            <div class="qcard" data-quick="Lake">
              <b>Famous Lakes</b><p>Chandratal, Rewalsar‚Ä¶</p>
            </div>
            <div class="qcard" data-quick="Temple">
              <b>Temples</b><p>Jwalamukhi, Bijli Mahadev‚Ä¶</p>
            </div>
            <div class="qcard" data-quick="Destination">
              <b>Must Visit</b><p>Manali, Shimla, Spiti‚Ä¶</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- DISTRICTS -->
    <section class="section" id="districts">
      <div class="sectionTitle">
        <div>
          <h2>District shortcuts</h2>
          <p>Tap any district ‚Üí filters apply instantly.</p>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn ghost" id="showAllDistricts">Show All</button>
        </div>
      </div>

      <div class="districts" id="districtGrid"></div>
    </section>

    <!-- EXPLORE -->
    <section class="section" id="explore">
      <div class="sectionTitle">
        <div>
          <h2>Explore places + map</h2>
          <p>Clean list on left, premium map on right.</p>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <span class="pill"><span class="dot"></span><span id="activeFilters">No filters</span></span>
        </div>
      </div>

      <div class="grid2">
        <div class="panel results">
          <div class="panelHead">
            <h3>Places</h3>
            <small id="count">0</small>
          </div>
          <div class="list" id="list"></div>
        </div>

        <div class="mapBox">
          <div id="map"></div>
        </div>
      </div>
    </section>
  </div>

  <!-- PLACE DRAWER -->
  <div class="drawerWrap" id="drawerWrap" role="dialog" aria-modal="true" aria-label="Place details">
    <div class="drawer">
      <div class="drawerTop">
        <div>
          <h3 id="dTitle">Place</h3>
          <small id="dSub" style="color:var(--muted); font-weight:750">‚Äî</small>
        </div>
        <button class="closeX" id="closeDrawer">‚úï</button>
      </div>
      <div class="drawerBody">
        <div class="gallery" id="gallery"></div>
        <div class="infoCard">
          <p id="dDesc">‚Äî</p>
          <div class="row" style="gap:8px">
            <span class="badge" id="dType">Type</span>
            <span class="badge" id="dDistrict">District</span>
            <span class="badge" id="dHow">How to reach</span>
          </div>
          <div class="row">
            <button class="btn" id="routeBtn">Route on map</button>
            <button class="btn ghost" id="pkgBtn">3‚Äì4 Packages</button>
          </div>
          <div class="panel" style="margin-top:6px">
            <div class="panelHead">
              <h3>Suggested mini-plan</h3>
              <small>auto</small>
            </div>
            <div style="padding:12px">
              <p id="miniPlan" style="margin:0; color:var(--muted); font-weight:650; line-height:1.45; font-size:12px">
                ‚Äî
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- AI MODAL -->
  <div class="modalWrap" id="modalWrap" role="dialog" aria-modal="true" aria-label="AI Trip Planner">
    <div class="modal">
      <div class="modalHead">
        <div>
          <h3>AI Trip Planner (On-page)</h3>
          <small style="color:var(--muted); font-weight:750">Ask days, people, interests ‚Üí get suggestions</small>
        </div>
        <button class="closeX" id="closeAI">‚úï</button>
      </div>
      <div class="chat" id="chat"></div>
      <div class="composer">
        <input id="chatInput" placeholder="Example: 4 days, couple, nature + temples, starting Shimla"/>
        <button class="btn" id="sendChat">Send</button>
      </div>
    </div>
  </div>

<script>
/* =========================
   1) DATA SOURCE
   =========================
   If Firebase not configured, demo data is used.
   You can connect Firebase RTDB later by setting:
   - firebaseConfig
   - dbPath (where your places live)
*/
const firebaseConfig = {
  // TODO: paste your firebase config here
  // apiKey: "",
  // authDomain: "",
  // databaseURL: "",
  // projectId: "",
  // storageBucket: "",
  // messagingSenderId: "",
  // appId: ""
};

const dbPath = "places"; // your RTDB node name e.g. "locations" / "places"

/* Expected place format:
{
  id: "auto",
  name: "Khajjiar",
  district: "Chamba",
  type: "Lake",
  lat: 32.55,
  lng: 76.06,
  brief: "Mini Switzerland‚Ä¶",
  how: "Drive from Dalhousie",
  images: ["url1","url2"...] OR image: "url"
}
*/

const DEMO_PLACES = [
  {name:"Shimla (The Ridge)", district:"Shimla", type:"Destination", lat:31.1048, lng:77.1734,
   brief:"The iconic heart of Shimla‚Äîcolonial vibes, views, cafes, evening strolls.", how:"Road from Chandigarh / Kalka-Shimla toy train",
   images:[
     "https://upload.wikimedia.org/wikipedia/commons/4/4c/The_Ridge_Shimla_5.jpg",
     "https://upload.wikimedia.org/wikipedia/commons/8/8e/Shimla_India_Ridge.JPG"
   ]
  },
  {name:"Kufri", district:"Shimla", type:"Destination", lat:31.0976, lng:77.2673,
   brief:"Snow viewpoints, forests and fun rides‚Äîbest for quick day trips.", how:"Drive ~16 km from Shimla",
   images:["https://images.unsplash.com/photo-1599249300675-c39f1dd2d6be?auto=format&fit=crop&w=1200&q=70"]
  },
  {name:"Manali", district:"Kullu", type:"Destination", lat:32.2432, lng:77.1892,
   brief:"Riverside town with cafes, snow routes, valleys and adventure.", how:"Road via Mandi‚ÄìKullu",
   images:[
     "https://upload.wikimedia.org/wikipedia/commons/0/0e/Manali_view.jpg",
     "https://upload.wikimedia.org/wikipedia/commons/d/d3/Hadimba_Temple_Manali.jpg"
   ]
  },
  {name:"Triund Trek", district:"Kangra", type:"Trek", lat:32.2423, lng:76.3202,
   brief:"Classic Himalayan trek with Dhauladhar views near McLeod Ganj.", how:"Start from McLeod Ganj / Dharamkot",
   images:["https://upload.wikimedia.org/wikipedia/commons/2/2b/Triund_Trek.jpg"]
  },
  {name:"Khajjiar", district:"Chamba", type:"Lake", lat:32.5495, lng:76.0669,
   brief:"Meadows + lake + pine forests‚Äîpopular scenic stop near Dalhousie.", how:"Drive from Dalhousie (~22 km)",
   images:["https://upload.wikimedia.org/wikipedia/commons/9/96/Khajjiar_Lake.jpg"]
  },
  {name:"Chandratal Lake", district:"Lahaul-Spiti", type:"Lake", lat:32.4762, lng:77.6156,
   brief:"High-altitude ‚ÄòMoon Lake‚Äô‚Äîunreal colors, best in summer season.", how:"Via Kunzum Pass; requires permits/road status check",
   images:["https://upload.wikimedia.org/wikipedia/commons/4/45/Chandratal_Lake.jpg"]
  }
];

/* =========================
   2) UI + MAP SETUP
   ========================= */
const $ = (id)=>document.getElementById(id);

let allPlaces = [];
let shownPlaces = [];
let markers = [];
let map, markerLayer;

function safeText(v){ return (v ?? "").toString().trim(); }

function normalizeType(t){
  t = safeText(t);
  if(!t) return "Destination";
  const low = t.toLowerCase();
  if(low.includes("temple")) return "Temple";
  if(low.includes("lake")) return "Lake";
  if(low.includes("trek") || low.includes("trail")) return "Trek";
  if(low.includes("hotel") || low.includes("stay")) return "Hotel";
  if(low.includes("activity") || low.includes("adventure")) return "Activity";
  if(low.includes("dest") || low.includes("place")) return "Destination";
  return t[0].toUpperCase() + t.slice(1);
}

function placeImages(p){
  if(Array.isArray(p.images) && p.images.length) return p.images.filter(Boolean);
  if(p.image) return [p.image];
  return [];
}

function typeColor(type){
  switch(type){
    case "Trek": return "rgba(103,232,249,.22)";
    case "Lake": return "rgba(52,211,153,.20)";
    case "Temple": return "rgba(255,207,90,.18)";
    case "Hotel": return "rgba(167,139,250,.18)";
    case "Activity": return "rgba(255,107,107,.16)";
    default: return "rgba(255,255,255,.10)";
  }
}

function initMap(){
  map = L.map('map', {zoomControl:true}).setView([31.9, 77.2], 7);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  markerLayer = L.layerGroup().addTo(map);
}

function clearMarkers(){
  markerLayer.clearLayers();
  markers = [];
}

function addMarkers(list){
  clearMarkers();
  list.forEach((p)=>{
    if(!p.lat || !p.lng) return;
    const t = p.type || "Destination";
    const m = L.marker([p.lat, p.lng]).addTo(markerLayer);
    m.bindPopup(`<b>${escapeHtml(p.name)}</b><br/><span style="opacity:.8">${escapeHtml(p.district)} ‚Ä¢ ${escapeHtml(t)}</span>`);
    m.on('click', ()=> openDrawer(p));
    markers.push(m);
  });

  // Fit bounds if enough points
  const pts = list.filter(p=>p.lat && p.lng).map(p=>[p.lat, p.lng]);
  if(pts.length >= 2){
    map.fitBounds(pts, {padding:[30,30]});
  }else if(pts.length === 1){
    map.setView(pts[0], 11);
  }
}

function escapeHtml(str){
  return safeText(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;");
}

/* =========================
   3) LOAD DATA (Firebase or Demo)
   ========================= */
async function loadPlaces(){
  const hasFirebase = firebaseConfig && firebaseConfig.databaseURL && firebaseConfig.apiKey;
  if(!hasFirebase){
    allPlaces = DEMO_PLACES.map(p=>({
      ...p,
      type: normalizeType(p.type),
      district: safeText(p.district) || "Unknown",
      lat: Number(p.lat) || null,
      lng: Number(p.lng) || null
    }));
    return;
  }

  try{
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const snap = await db.ref(dbPath).once('value');
    const val = snap.val() || {};

    // Accept both array-like and object
    const arr = Array.isArray(val) ? val.filter(Boolean) : Object.values(val);

    allPlaces = arr.map(p=>({
      ...p,
      name: safeText(p.name || p.title),
      district: safeText(p.district),
      type: normalizeType(p.type || p.category),
      lat: Number(p.lat || p.latitude) || null,
      lng: Number(p.lng || p.longitude) || null,
      brief: safeText(p.brief || p.description || p.about),
      how: safeText(p.how || p.howToReach || p.reach)
    })).filter(p=>p.name);

  }catch(e){
    console.warn("Firebase load failed. Using demo.", e);
    allPlaces = DEMO_PLACES;
  }
}

/* =========================
   4) BUILD DISTRICT GRID + FILTERS
   ========================= */
function getDistrictStats(){
  const by = new Map();
  allPlaces.forEach(p=>{
    const d = p.district || "Unknown";
    if(!by.has(d)) by.set(d, {count:0, types:new Set()});
    const obj = by.get(d);
    obj.count += 1;
    obj.types.add(p.type);
  });
  return by;
}

function buildDistrictDropdown(){
  const distSel = $("district");
  const districts = [...new Set(allPlaces.map(p=>p.district).filter(Boolean))].sort();
  distSel.innerHTML = `<option value="all">All</option>` + districts.map(d=>`<option value="${escapeHtml(d)}">${escapeHtml(d)}</option>`).join("");
}

function buildDistrictGrid(){
  const grid = $("districtGrid");
  const by = getDistrictStats();
  const districts = [...by.keys()].sort((a,b)=>a.localeCompare(b));
  grid.innerHTML = districts.map(d=>{
    const info = by.get(d);
    const types = [...info.types].slice(0,3);
    const tags = [
      `${info.count} places`,
      ...types
    ].slice(0,3);

    return `
      <div class="dItem" data-d="${escapeHtml(d)}">
        <b>${escapeHtml(d)}</b>
        <div class="dMeta">
          ${tags.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("")}
        </div>
      </div>
    `;
  }).join("");

  grid.querySelectorAll(".dItem").forEach(el=>{
    el.addEventListener("click", ()=>{
      $("district").value = el.getAttribute("data-d");
      applyFilters(true);
      location.hash = "#explore";
    });
  });

  // quick show all
  $("showAllDistricts").onclick = ()=>{
    $("district").value = "all";
    applyFilters(true);
    location.hash = "#explore";
  };
}

function applyFilters(scrollToList=false){
  const q = safeText($("q").value).toLowerCase();
  const d = $("district").value;
  const t = $("type").value;
  const days = Number($("days").value||0);

  shownPlaces = allPlaces.filter(p=>{
    if(d !== "all" && p.district !== d) return false;
    if(t !== "all" && p.type !== t) return false;

    if(q){
      const hay = `${p.name} ${p.district} ${p.type} ${p.brief} ${p.how}`.toLowerCase();
      if(!hay.includes(q)) return false;
    }

    // Lightweight days logic (optional)
    if(days){
      // rough heuristics
      const type = p.type;
      if(days <= 2){
        // Prefer near-city / easy
        if(type === "Trek") return false;
      }
    }
    return true;
  });

  renderList(shownPlaces);
  addMarkers(shownPlaces);
  updateStats();
  updateActiveFilters();

  if(scrollToList) $("list").scrollTo({top:0, behavior:"smooth"});
}

function updateActiveFilters(){
  const parts = [];
  const d = $("district").value;
  const t = $("type").value;
  const q = safeText($("q").value);
  const days = Number($("days").value||0);

  if(d !== "all") parts.push(d);
  if(t !== "all") parts.push(t);
  if(days) parts.push(`${days}+ days`);
  if(q) parts.push(`‚Äú${q}‚Äù`);

  $("activeFilters").textContent = parts.length ? parts.join(" ‚Ä¢ ") : "No filters";
}

function updateStats(){
  const districts = new Set(allPlaces.map(p=>p.district).filter(Boolean));
  const types = new Set(allPlaces.map(p=>p.type).filter(Boolean));
  $("statPlaces").textContent = allPlaces.length.toString();
  $("statDistricts").textContent = districts.size.toString();
  $("statTypes").textContent = types.size.toString();
  $("statShown").textContent = shownPlaces.length.toString();
  $("count").textContent = `${shownPlaces.length} shown`;
}

/* =========================
   5) RENDER LIST
   ========================= */
function renderList(list){
  const box = $("list");
  if(!list.length){
    box.innerHTML = `<div style="padding:14px; color:rgba(255,255,255,.7); font-weight:750">
      No results. Try changing district/type or search.
    </div>`;
    return;
  }

  box.innerHTML = list.map((p, idx)=>{
    const imgs = placeImages(p);
    const thumb = imgs[0] || "";
    const badgeBg = typeColor(p.type);
    const brief = safeText(p.brief) || "Explore this place in Himachal Pradesh.";
    const meta = `${safeText(p.district)} ‚Ä¢ ${safeText(p.type)}`;

    return `
      <div class="place" data-i="${idx}">
        <div class="thumb">
          ${thumb ? `<img src="${thumb}" alt="${escapeHtml(p.name)}" loading="lazy" onerror="this.style.display='none'">` : ``}
        </div>
        <div>
          <p class="pTitle">${escapeHtml(p.name)}</p>
          <p class="pSub">${escapeHtml(meta)} ‚Äî ${escapeHtml(brief)}</p>
          <div class="pBadges">
            <span class="badge" style="background:${badgeBg}">${escapeHtml(p.type)}</span>
            <span class="badge">${escapeHtml(p.district)}</span>
            ${p.lat && p.lng ? `<span class="badge">üìç ${p.lat.toFixed(3)}, ${p.lng.toFixed(3)}</span>` : ``}
          </div>
        </div>
      </div>
    `;
  }).join("");

  box.querySelectorAll(".place").forEach(el=>{
    el.addEventListener("click", ()=>{
      const i = Number(el.getAttribute("data-i"));
      openDrawer(list[i]);
    });
  });
}

/* =========================
   6) DRAWER (PLACE DETAILS)
   ========================= */
let currentPlace = null;

function openDrawer(p){
  currentPlace = p;
  $("dTitle").textContent = p.name;
  $("dSub").textContent = `${p.district} ‚Ä¢ ${p.type}`;
  $("dDesc").textContent = safeText(p.brief) || "No description available yet.";
  $("dType").textContent = p.type;
  $("dDistrict").textContent = p.district;
  $("dHow").textContent = (safeText(p.how) ? `Reach: ${p.how}` : "Reach: ‚Äî");

  // Gallery max 5
  const imgs = placeImages(p).slice(0,5);
  const g = $("gallery");
  if(imgs.length){
    g.innerHTML = imgs.map(u=>`
      <div class="gImg"><img src="${u}" alt="${escapeHtml(p.name)}" loading="lazy"/></div>
    `).join("");
  }else{
    g.innerHTML = `
      <div class="gImg" style="display:flex; align-items:center; justify-content:center; padding:14px; color:rgba(255,255,255,.7); font-weight:750">
        No images yet
      </div>`;
  }

  $("miniPlan").textContent = buildMiniPlan(p);

  $("drawerWrap").style.display = "flex";
}

function closeDrawer(){
  $("drawerWrap").style.display = "none";
  currentPlace = null;
}

function buildMiniPlan(p){
  const type = p.type;
  if(type === "Trek") return "Suggested: start early, carry water + warm layer, plan return before sunset. Add one nearby viewpoint & one cafe stop.";
  if(type === "Lake") return "Suggested: visit sunrise/sunset for best photos. Keep buffer for road conditions. Pair with a nearby temple or meadow.";
  if(type === "Temple") return "Suggested: morning darshan + explore local market/food. Add 1 nature spot nearby to balance the day.";
  if(type === "Hotel") return "Suggested: use this as base. Add 2 nearby places + 1 sunset point. Keep a relaxed evening walk & local dinner.";
  return "Suggested: 1 main attraction + 2 nearby spots + local food stop. Keep time for photos + slow travel.";
}

$("closeDrawer").onclick = closeDrawer;
$("drawerWrap").addEventListener("click", (e)=>{
  if(e.target === $("drawerWrap")) closeDrawer();
});

$("routeBtn").onclick = ()=>{
  if(!currentPlace || !currentPlace.lat || !currentPlace.lng) return;
  map.setView([currentPlace.lat, currentPlace.lng], 12);
  closeDrawer();
  location.hash = "#explore";
};

$("pkgBtn").onclick = ()=>{
  if(!currentPlace) return;
  // quick package suggestions
  const base = currentPlace.name;
  const district = currentPlace.district;
  const type = currentPlace.type;

  const pack = [
    `Package A: ${district} Highlights (2D/1N) ‚Äî ${base} + 2 nearby spots + local food.`,
    `Package B: Nature & Photos (3D/2N) ‚Äî ${base} + scenic points + relaxed pace.`,
    `Package C: Family Comfort (4D/3N) ‚Äî easy routes + viewpoints + market + caf√©s.`,
    `Package D: Adventure Mix (5D/4N) ‚Äî trek/activities + lake + sunset point.`
  ].slice(0,4);

  alert(pack.join("\n\n"));
};

/* =========================
   7) NEARBY (GPS)
   ========================= */
$("nearby").onclick = ()=>{
  if(!navigator.geolocation){
    alert("GPS not supported on this device/browser.");
    return;
  }
  $("status").textContent = "Getting your location‚Ä¶";
  navigator.geolocation.getCurrentPosition((pos)=>{
    const me = {lat: pos.coords.latitude, lng: pos.coords.longitude};
    map.setView([me.lat, me.lng], 10);
    L.circleMarker([me.lat, me.lng], {
      radius:8, weight:2, fillOpacity:.25
    }).addTo(markerLayer).bindPopup("You are here").openPopup();

    // sort by distance (simple)
    const withDist = allPlaces
      .filter(p=>p.lat && p.lng)
      .map(p=>({p, km: haversine(me.lat, me.lng, p.lat, p.lng)}))
      .sort((a,b)=>a.km-b.km)
      .slice(0, 20)
      .map(x=>({...x.p, _km:x.km}));

    // show nearest 20
    shownPlaces = withDist;
    renderList(shownPlaces);
    addMarkers(shownPlaces);
    updateStats();
    updateActiveFilters();
    $("status").textContent = "Showing nearby places.";
    location.hash = "#explore";
  }, ()=>{
    $("status").textContent = "GPS permission denied.";
    alert("Please allow location permission to use Nearby.");
  }, {enableHighAccuracy:true, timeout:12000});
};

function haversine(lat1, lon1, lat2, lon2){
  const R = 6371;
  const toRad = (d)=> d * Math.PI/180;
  const dLat = toRad(lat2-lat1);
  const dLon = toRad(lon2-lon1);
  const a = Math.sin(dLat/2)**2 +
            Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return 2*R*Math.asin(Math.sqrt(a));
}

/* =========================
   8) AI MODAL (On-page logic)
   ========================= */
function openAI(){ $("modalWrap").style.display="flex"; }
function closeAI(){ $("modalWrap").style.display="none"; }

$("openAI").onclick = openAI;
$("closeAI").onclick = closeAI;
$("modalWrap").addEventListener("click",(e)=>{ if(e.target === $("modalWrap")) closeAI(); });

function pushMsg(text, who="bot"){
  const div = document.createElement("div");
  div.className = "msg " + (who==="me" ? "me" : "");
  div.textContent = text;
  $("chat").appendChild(div);
  $("chat").scrollTop = $("chat").scrollHeight;
}

function aiSuggest(userText){
  // Lightweight deterministic "AI-like" suggestion using your loaded places.
  const t = userText.toLowerCase();

  // parse days
  let days = 0;
  const m = t.match(/(\d+)\s*(day|days|d)/);
  if(m) days = Number(m[1]);

  // detect interests
  const wants = {
    trek: /trek|hike|trail|adventure/.test(t),
    lake: /lake|chandratal|prashar|rewalsar|manimahesh/.test(t),
    temple: /temple|mandir|devi|mahadev|monastery/.test(t),
    snow: /snow|winter|ice/.test(t),
    relax: /relax|peace|family|easy/.test(t),
  };

  // starting district / place hint
  let districtHint = null;
  const districts = [...new Set(allPlaces.map(p=>p.district))];
  for(const d of districts){
    if(t.includes(d.toLowerCase())) { districtHint = d; break; }
  }

  // score places
  const scored = allPlaces.map(p=>{
    let s=0;
    if(districtHint && p.district===districtHint) s += 3;
    if(wants.trek && p.type==="Trek") s += 3;
    if(wants.lake && p.type==="Lake") s += 3;
    if(wants.temple && p.type==="Temple") s += 3;
    if(wants.relax && p.type!=="Trek") s += 1;
    if(wants.snow && /manali|kufri|rohtang|solang/i.test(p.name)) s += 2;
    return {p, s};
  }).sort((a,b)=>b.s-a.s);

  const pick = scored.filter(x=>x.s>0).slice(0, Math.min(6, days? Math.max(3, Math.min(6, Math.ceil(days*1.2))) : 5)).map(x=>x.p);
  const fallback = allPlaces.slice(0,5);

  const list = (pick.length ? pick : fallback)
    .map((p,i)=>`${i+1}. ${p.name} (${p.district} ‚Ä¢ ${p.type})`)
    .join("\n");

  const packs = [
    "Package 1 (Comfort): 2‚Äì3 core places + easy driving + good food stops",
    "Package 2 (Balanced): 1 trek + 1 lake/temple + 1 market/day cafe time",
    "Package 3 (Adventure): trek/activity heavy + sunrise/sunset points",
    "Package 4 (Family): short transfers + viewpoints + local experiences"
  ];

  return `Based on your message, here are good picks:\n${list}\n\nSuggested package styles:\n- ${packs.slice(0,4).join("\n- ")}`;
}

$("sendChat").onclick = ()=>{
  const v = safeText($("chatInput").value);
  if(!v) return;
  pushMsg(v, "me");
  $("chatInput").value = "";

  const reply = aiSuggest(v);
  pushMsg(reply, "bot");
};

function seedChat(){
  $("chat").innerHTML = "";
  pushMsg("Tell me: days + people + interests (trek/lake/temple/snow/relax) + starting place/district.", "bot");
  pushMsg("Example: 4 days, couple, nature + temples, starting Shimla", "bot");
}

/* =========================
   9) ACTIONS
   ========================= */
$("apply").onclick = ()=>{ applyFilters(true); location.hash="#explore"; };
$("reset").onclick = ()=>{
  $("q").value = "";
  $("district").value = "all";
  $("type").value = "all";
  $("days").value = "0";
  applyFilters(true);
};

document.querySelectorAll(".qcard").forEach(el=>{
  el.addEventListener("click", ()=>{
    $("type").value = el.getAttribute("data-quick");
    applyFilters(true);
    location.hash="#explore";
  });
});

$("openAdmin").onclick = ()=>{
  alert("Admin page is optional. If you want, I‚Äôll create /admin.html for adding places + uploading images + pushing to Firebase.");
};

/* =========================
   10) INIT
   ========================= */
(async function init(){
  initMap();
  await loadPlaces();

  // normalize
  allPlaces = allPlaces.map(p=>({
    ...p,
    name: safeText(p.name),
    district: safeText(p.district) || "Unknown",
    type: normalizeType(p.type),
  }));

  $("status").textContent = `Loaded ${allPlaces.length} places.`;

  buildDistrictDropdown();
  buildDistrictGrid();

  // initial view: show "must visit" (Destination)
  shownPlaces = allPlaces.slice();
  applyFilters(false);

  seedChat();
})();
</script>
</body>
</html>