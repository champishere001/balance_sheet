<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <!-- =========================
       SEO (Google Search)
  ========================== -->
  <title>Himachal Tour Packages | Himachal Explorer Portal (Routes, Maps, Day-wise Itinerary)</title>
  <meta name="description" content="Explore Himachal tour packages with live map routes, day-wise itineraries, nearby places, and place detail popups. Himachal Explorer Portal."/>
  <meta name="keywords" content="Himachal tour packages, Himachal itinerary, Shimla Manali package, Dharamshala Dalhousie tour, Himachal trip planner, Himachal Explorer, road route map, Himachal travel"/>
  <meta name="author" content="Himachal Explorer"/>
  <meta name="robots" content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1"/>
  <meta name="theme-color" content="#070A12"/>

  <!-- ✅ IMPORTANT: Set your real site URL here -->
  <!-- If using GitHub Pages: https://champishere001.github.io/ -->
  <link rel="canonical" href="https://champishere001.github.io/"/>

  <!-- Open Graph -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Himachal Tour Packages | Himachal Explorer Portal"/>
  <meta property="og:description" content="Live route maps + day-wise itinerary + place details for Himachal tour packages."/>
  <meta property="og:url" content="https://champishere001.github.io/"/>
  <meta property="og:image" content="https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1200&q=70"/>

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Himachal Explorer Portal"/>
  <meta name="twitter:description" content="Himachal packages with maps + day-wise itinerary + place popups."/>
  <meta name="twitter:image" content="https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1200&q=70"/>

  <!-- JSON-LD (Structured Data) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"Himachal Explorer Portal",
    "url":"https://champishere001.github.io/",
    "description":"Himachal tour packages with routes, map, day-wise itineraries and place details.",
    "inLanguage":"en",
    "publisher":{
      "@type":"Organization",
      "name":"Himachal Explorer"
    }
  }
  </script>

  <!-- Preconnect -->
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-analytics-compat.js"></script>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1220;
      --stroke:rgba(255,255,255,.10);
      --muted:rgba(255,255,255,.65);
      --text:rgba(255,255,255,.92);
      --shadow: 0 24px 90px rgba(0,0,0,.55);
      --radius: 18px;
      --acc:#7C3AED;

      --topH: 92px;
      --gap: 14px;

      --leftPct: 36%;
      --mapPct: 24%;
      --rightPct: 40%;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(124,58,237,.18), transparent 60%),
        radial-gradient(900px 520px at 85% 10%, rgba(34,197,94,.14), transparent 60%),
        radial-gradient(900px 520px at 50% 90%, rgba(6,182,212,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:auto;
    }

    .aurora{
      position:fixed; inset:-30%;
      background:
        radial-gradient(900px 500px at 25% 30%, rgba(124,58,237,.22), transparent 65%),
        radial-gradient(900px 520px at 75% 25%, rgba(34,197,94,.18), transparent 66%),
        radial-gradient(860px 540px at 55% 75%, rgba(6,182,212,.14), transparent 66%);
      filter: blur(45px);
      opacity:.9;
      animation: drift 14s ease-in-out infinite;
      pointer-events:none;
      z-index:-3;
    }
    @keyframes drift{
      0%,100%{ transform: translate3d(0,0,0) scale(1); }
      50%{ transform: translate3d(3%, -2%, 0) scale(1.06); }
    }
    .noise{
      position:fixed; inset:0; z-index:-2; pointer-events:none; opacity:.12; mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
    }

    .app{ min-height:100%; display:grid; grid-template-rows: var(--topH) 1fr; }

    .top{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 14px 12px;
      border-bottom: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      backdrop-filter: blur(14px);
      gap: 12px;
    }

    .brand{ display:flex; align-items:center; gap:12px; min-width: 260px; }
    .logo{
      width:54px; height:54px; border-radius:16px;
      background: rgba(255,255,255,.10);
      border:1px solid var(--stroke);
      display:grid; place-items:center;
      overflow:hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block; }
    .brand h1{ margin:0; font-size:14px; letter-spacing:.18em; text-transform:uppercase; }
    .brand p{ margin:4px 0 0; font-size:12px; color:var(--muted); line-height:1.25; }

    .actions{
      display:flex; gap:10px; align-items:center;
      min-width: 260px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .chip{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing:.08em;
      display:inline-flex; align-items:center; gap:10px;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(12px);
      white-space: nowrap;
    }
    .chip:hover{ background: rgba(255,255,255,.08); color: rgba(255,255,255,.82); }

    .main{
      height: calc(100vh - var(--topH));
      display:grid;
      grid-template-columns: var(--leftPct) var(--mapPct) var(--rightPct);
      gap: var(--gap);
      padding: 14px;
      overflow: hidden;
    }

    .pane{
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;

      display:flex;
      flex-direction:column;

      height:100%;
      min-height:0;
    }

    .paneHdr{
      padding: 12px 12px 10px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex:0 0 auto;
    }
    .paneHdr .t{
      font-size:12px;
      letter-spacing:.18em;
      text-transform: uppercase;
      margin:0;
    }
    .paneHdr .s{
      font-size:11px;
      color:var(--muted);
      letter-spacing:.08em;
      text-transform: uppercase;
    }

    .filters{
      padding: 12px;
      border-bottom:1px solid var(--stroke);
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      flex:0 0 auto;
    }
    .field label{
      display:block;
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing:.12em;
      margin:0 0 6px 2px;
    }
    input, select{
      width:100%;
      padding: 11px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      outline:none;
    }
    input:focus, select:focus{
      border-color: rgba(124,58,237,.55);
      box-shadow: 0 0 0 3px rgba(124,58,237,.16);
    }

    /* ✅ buttons not huge */
    .btnRow{ display:flex; gap:10px; align-items:center; }
    .btn{
      flex:0 0 auto;
      padding: 11px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(6,182,212,.65));
      color:#fff;
      font-weight: 900;
      letter-spacing:.10em;
      text-transform: uppercase;
      cursor:pointer;
      width:auto;
      min-width: 130px;
      max-width: 190px;
      white-space: nowrap;
    }
    .btn.secondary{ background: rgba(255,255,255,.06); color: rgba(255,255,255,.85); }
    .btn:hover{ filter: brightness(1.05); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px); }
    @media (max-width: 520px){ .btnRow{ flex-wrap:wrap; } .btn{ flex:1 1 0; max-width:unset; } }

    .metaPills{
      padding: 0 12px 12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--stroke);
      flex:0 0 auto;
    }
    .pill{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 11px;
      letter-spacing:.10em;
      text-transform: uppercase;
      color: rgba(255,255,255,.78);
      display:inline-flex; align-items:center; gap:8px;
    }
    .pill b{ color:#fff; letter-spacing:.06em; }

    .pkgLayout{
      flex:1;
      display:grid;
      grid-template-columns: 160px 1fr;
      min-height:0;
      overflow:hidden;
    }
    .districtBar{
      border-right:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      overflow:auto;
      padding:10px;
      min-height:0;
    }
    .distItem{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.86);
      border-radius: 14px;
      padding:10px 10px;
      font-size: 11px;
      letter-spacing:.10em;
      text-transform: uppercase;
      margin-bottom:10px;
      cursor:pointer;
      user-select:none;
    }
    .distItem:hover{ background: rgba(255,255,255,.08); }
    .distItem.active{
      border-color: rgba(124,58,237,.70);
      box-shadow: 0 0 0 3px rgba(124,58,237,.16);
      background: rgba(124,58,237,.12);
    }

    .pkgList{
      padding: 12px;
      overflow:auto;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      min-height:0;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
    }

    .pkgGroupHdr{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 10px;
    }
    .pkgGroupHdr .h1{
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.12em;
      text-transform: uppercase;
    }
    .pkgGroupHdr .h2{
      margin-top:6px;
      font-size: 11px;
      color: rgba(255,255,255,.75);
      letter-spacing:.08em;
      text-transform: uppercase;
      line-height: 1.35;
    }

    .pkg{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 10px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      display:flex; gap:10px;
      min-width:0;
    }
    .pkg:hover{ transform: translateY(-1px); border-color: rgba(124,58,237,.35); background: rgba(0,0,0,.28); }
    .pkg.active{ border-color: rgba(124,58,237,.70); box-shadow: 0 0 0 3px rgba(124,58,237,.18); }

    .pkgPic{
      width:58px; height:58px; border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.14), rgba(124,58,237,.18));
      overflow:hidden;
      flex:0 0 auto;
      display:grid; place-items:center;
      font-weight: 950;
      color: rgba(255,255,255,.85);
    }
    .pkgPic img{ width:100%; height:100%; object-fit:cover; display:block; }
    .pkgBody{ min-width:0; flex:1; }
    .pkgName{
      font-size: 12.5px;
      font-weight: 950;
      letter-spacing:.10em;
      text-transform: uppercase;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      margin-bottom: 6px;
    }
    .pkgMeta{
      font-size: 11px;
      color: rgba(255,255,255,.72);
      letter-spacing:.08em;
      text-transform: uppercase;
      line-height: 1.35;
    }
    .diffLine{
      margin-top:6px;
      font-size: 11px;
      color: rgba(255,255,255,.88);
      letter-spacing:.04em;
      text-transform:none;
      line-height:1.35;
      opacity:.98;
    }

    /* Map */
    #map{
      width:100%;
      height:100%;
      min-height:0;
      background: rgba(255,255,255,.04);
    }
    .mapTools{
      padding: 10px 12px;
      border-top:1px solid var(--stroke);
      display:flex; gap:10px; flex-wrap:wrap;
      flex:0 0 auto;
    }
    .toolBtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.88);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 11px;
      letter-spacing:.12em;
      text-transform: uppercase;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:10px;
      user-select:none;
      white-space: nowrap;
      text-decoration:none;
    }
    .toolBtn:hover{ background: rgba(255,255,255,.08); }

    /* Right itinerary */
    .itWrap{
      padding: 12px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
      flex:1;
    }
    .heroCard{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 12px;
    }
    .bigTitle{
      margin:0;
      font-size: 13px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color:#fff;
    }
    .muted{ color: var(--muted); font-size: 11.5px; letter-spacing:.08em; text-transform: uppercase; line-height:1.35; }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .mini{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 10px;
    }
    .mini .k{ font-size: 10.5px; letter-spacing:.16em; text-transform: uppercase; color: rgba(255,255,255,.70); }
    .mini .v{ margin-top:6px; font-size: 14px; font-weight: 950; letter-spacing:.06em; color:#fff; }
    .mini .v small{ font-size: 11px; color: rgba(255,255,255,.72); font-weight: 800; }

    .daysList{ display:flex; flex-direction:column; gap:10px; }

    .dayCard{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 12px;
    }
    .dayTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom: 8px;
    }
    .dayTop .d{
      font-size: 12px; font-weight: 950; letter-spacing:.18em; text-transform: uppercase;
    }
    .dayTop .dateTag{
      font-size: 10.5px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: rgba(255,255,255,.72);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      padding:6px 8px;
      border-radius: 999px;
      white-space:nowrap;
    }

    .placeLine{
      display:flex; align-items:center; gap:10px;
      padding: 8px 10px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      border-radius: 14px;
      margin-top: 8px;
      cursor:pointer;
    }
    .placeLine:hover{ background: rgba(255,255,255,.08); }

    .thumb{
      width:40px; height:40px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.14), rgba(6,182,212,.18));
      flex:0 0 auto;
      display:grid; place-items:center;
      font-weight:950;
      color: rgba(255,255,255,.9);
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

    .pinfo{ min-width:0; flex:1; }
    .pname{
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.10em;
      text-transform: uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .pmeta{
      margin-top:3px;
      font-size: 10.5px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: rgba(255,255,255,.68);
      white-space:nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* Place popup modal */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index:99999;
      background: rgba(0,0,0,.58);
      backdrop-filter: blur(8px);
    }
    .modal.show{ display:flex; }

    .modalCard{
      width:min(860px, 100%);
      max-height: min(86vh, 860px);
      overflow:hidden;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,14,24,.92);
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .modalHdr{
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex:0 0 auto;
    }
    .modalHdr .ttl{
      font-size: 12px;
      letter-spacing:.18em;
      text-transform: uppercase;
      font-weight:950;
      margin:0;
    }
    .xbtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:#fff;
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size:11px;
      font-weight:900;
    }
    .xbtn:hover{ background: rgba(255,255,255,.09); }

    .modalBody{
      padding:12px;
      overflow:auto;
      min-height:0;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:12px;
    }
    @media (max-width: 820px){
      .modalBody{ grid-template-columns:1fr; }
    }

    .placeHero{
      width:100%;
      height:200px;
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      position:relative;
    }
    .placeHero img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }

    .detailCard{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 12px;
    }
    .detailCard h3{
      margin:0 0 10px;
      font-size:11.5px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color:#fff;
    }
    .detailCard p{
      margin:0;
      color: rgba(255,255,255,.78);
      line-height:1.55;
      font-size: 13px;
    }
    .bullets{
      margin:8px 0 0;
      padding:0 0 0 16px;
      color: rgba(255,255,255,.78);
      line-height:1.55;
      font-size: 13px;
    }

    .toast{
      position:fixed;
      left: 14px;
      bottom: 14px;
      z-index: 9999;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,14,24,.88);
      border-radius: 16px;
      padding: 10px 12px;
      color: rgba(255,255,255,.82);
      font-size: 11px;
      letter-spacing:.12em;
      text-transform: uppercase;
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      display:none;
      max-width: 560px;
    }
    .toast.show{ display:block; }

    @media (max-width: 1200px){
      .main{
        grid-template-columns: 1fr;
        grid-template-rows: auto 420px auto;
        height:auto;
        overflow:visible;
      }
      #map{ height: 420px; }
      .pkgLayout{ grid-template-columns: 1fr; }
      .districtBar{
        display:flex; gap:10px; flex-wrap:wrap;
        border-right:none;
        border-bottom:1px solid rgba(255,255,255,.10);
      }
      .distItem{ margin-bottom:0; }
      .actions{ min-width:unset; }
    }
  </style>
</head>

<body>
  <div class="aurora"></div>
  <div class="noise"></div>

  <div class="app">
    <div class="top">
      <div class="brand">
        <div class="logo">
          <img alt="Himachal Explorer" src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=200&q=70">
        </div>
        <div>
          <h1>Himachal Explorer</h1>
          <p>Packages • Map • Day-wise itinerary • Place detail popup</p>
        </div>
      </div>

      <div class="actions">
        <div class="chip" id="chipHelp">How it works</div>
        <div class="chip" id="chipClear">Clear selection</div>
      </div>
    </div>

    <div class="main">

      <!-- LEFT -->
      <section class="pane" aria-label="Packages">
        <div class="paneHdr">
          <p class="t">Packages</p>
          <span class="s" id="pkgCount">Loading…</span>
        </div>

        <div class="filters">
          <div class="field">
            <label>Start Point</label>
            <select id="startPoint">
              <option value="Delhi">Delhi</option>
              <option value="Chandigarh">Chandigarh</option>
              <option value="Amritsar">Amritsar</option>
              <option value="Shimla">Shimla</option>
              <option value="Mandi">Mandi</option>
              <option value="Dharamshala">Dharamshala</option>
            </select>
          </div>

          <div class="field">
            <label>No. of Persons</label>
            <input id="persons" type="number" min="1" value="2"/>
          </div>

          <div class="field">
            <label>Trip Start Date</label>
            <input id="tripDate" type="date"/>
          </div>

          <div class="btnRow">
            <button class="btn secondary" id="resetBtn" type="button">Reset</button>
            <button class="btn" id="generateBtn" type="button">Generate</button>
          </div>
        </div>

        <div class="metaPills">
          <div class="pill">District <b id="pillDistrict">All</b></div>
          <div class="pill">Selected <b id="pillSelected">None</b></div>
        </div>

        <div class="pkgLayout">
          <div class="districtBar" id="districtBar"></div>
          <div class="pkgList" id="pkgList"></div>
        </div>
      </section>

      <!-- MAP -->
      <section class="pane" aria-label="Map">
        <div class="paneHdr">
          <p class="t">Map</p>
          <span class="s" id="mapStatus">Ready</span>
        </div>
        <div id="map"></div>
        <div class="mapTools">
          <a class="toolBtn" href="#" id="zoomHimachal">Zoom Himachal</a>
          <a class="toolBtn" href="#" id="fitRoute">Fit Route</a>
        </div>
      </section>

      <!-- RIGHT -->
      <section class="pane" aria-label="Itinerary">
        <div class="paneHdr">
          <p class="t">Itinerary</p>
          <span class="s" id="itiHint">Select a package</span>
        </div>

        <div class="itWrap" id="itWrap">
          <div class="heroCard">
            <h2 class="bigTitle" id="itiTitle">No package selected</h2>
            <div class="muted" id="itiSub">Choose a package from the left to see day-wise places (date-wise). Tap any place for popup details.</div>

            <div class="row2" style="margin-top:10px;">
              <div class="mini">
                <div class="k">Days</div>
                <div class="v" id="statDays">—</div>
              </div>
              <div class="mini">
                <div class="k">Places</div>
                <div class="v" id="statPlaces">—</div>
              </div>
            </div>
          </div>

          <div class="daysList" id="daysList"></div>
        </div>
      </section>

    </div>
  </div>

  <!-- PLACE DETAIL MODAL -->
  <div class="modal" id="placeModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHdr">
        <p class="ttl" id="modalTitle">Place</p>
        <button class="xbtn" id="modalClose" type="button">Close</button>
      </div>

      <div class="modalBody">
        <div>
          <div class="placeHero">
            <img id="modalImg" alt="Place image" src="" onerror="this.style.display='none'">
          </div>
        </div>

        <div style="display:flex; flex-direction:column; gap:12px; min-height:0;">
          <div class="detailCard">
            <h3>History</h3>
            <p id="modalAbout">—</p>
          </div>

          <div class="detailCard">
            <h3>What you can find</h3>
            <ul class="bullets" id="modalBullets"></ul>
          </div>

          <div class="detailCard">
            <h3>Meta</h3>
            <p id="modalMeta">—</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
/* =========================================================
   ✅ FIREBASE / GOOGLE CONFIG
   (You already shared this earlier)
========================================================= */
const firebaseConfig = {
  apiKey: "AIzaSyAKaFrj7JobWLloNQqzvx3SSibyrsiwzug",
  authDomain: "revnue-records.firebaseapp.com",
  databaseURL: "https://revnue-records-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "revnue-records",
  storageBucket: "revnue-records.firebasestorage.app",
  messagingSenderId: "182348503564",
  appId: "1:182348503564:web:480085405b09177245ac29",
  measurementId: ""
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
try { firebase.analytics(); } catch(e){}

/* =========================================================
   Helpers
========================================================= */
const $ = (id) => document.getElementById(id);

function toast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(toast._tmr);
  toast._tmr = setTimeout(()=>t.classList.remove("show"), 2200);
}

function toArray(val){
  if(!val) return [];
  if(Array.isArray(val)) return val.filter(Boolean);
  if(typeof val === "object") return Object.values(val).filter(Boolean);
  return [];
}

function fmtDateForDay(startDate, dayIndex0){
  try{
    const d = new Date(startDate);
    d.setDate(d.getDate() + dayIndex0);
    return d.toLocaleDateString(undefined,{ weekday:"short", day:"2-digit", month:"short", year:"numeric" });
  }catch(e){
    return "—";
  }
}

function splitBulletsSmart(v){
  if(!v) return [];
  if(Array.isArray(v)) return v.filter(Boolean).map(x=>String(x).trim()).filter(Boolean);
  const s = String(v).trim();
  if(!s) return [];
  return s.split(/\n|•|;|\||,/g).map(x=>x.trim()).filter(Boolean);
}

/* =========================================================
   Data containers
========================================================= */
let PLACES_BY_ID = {}; // { place_id: {...} }
let PACKAGES = [];     // array of package objects

let selectedDistrict = "ALL";
let selectedPackageId = null;

/* =========================================================
   Map
========================================================= */
let map, markersLayer, routeLayer;

function initMap(){
  map = L.map("map", { zoomControl:true }).setView([31.8, 77.3], 7);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap"
  }).addTo(map);

  markersLayer = L.layerGroup().addTo(map);
  routeLayer = L.polyline([], { weight: 4, opacity: 0.9 }).addTo(map);

  $("zoomHimachal").addEventListener("click", (e)=>{
    e.preventDefault();
    map.setView([31.85, 77.25], 7);
  });

  $("fitRoute").addEventListener("click", (e)=>{
    e.preventDefault();
    const latlngs = routeLayer.getLatLngs();
    if(latlngs.length) map.fitBounds(routeLayer.getBounds().pad(0.2));
    else toast("No route yet.");
  });
}

/* =========================================================
   Firebase loading (auto-tries common node names)
   ✅ No question — best effort by trying multiple paths
========================================================= */
async function readFirstWorkingPath(paths){
  for(const p of paths){
    try{
      const snap = await db.ref(p).once("value");
      const val = snap.val();
      if(val && (typeof val === "object")) return { path:p, val };
    }catch(e){}
  }
  return { path:null, val:null };
}

async function loadFirebaseData(){
  // Try common nodes you used earlier in chats
  const placesTry = ["places_in_packages", "places", "all_places", "place_master", "master_places"];
  const packagesTry = ["packages", "tour_packages", "package_master", "packages_master", "all_packages"];

  const placesRes = await readFirstWorkingPath(placesTry);
  const pkgRes = await readFirstWorkingPath(packagesTry);

  if(!placesRes.val){
    toast("Places not found in Firebase. Check DB path.");
  } else {
    // If places are array -> convert by place_id
    const pVal = placesRes.val;
    if(Array.isArray(pVal)){
      const obj = {};
      pVal.forEach(x=>{
        if(!x) return;
        const id = x.place_id || x.id || x.placeId;
        if(id) obj[id] = x;
      });
      PLACES_BY_ID = obj;
    } else {
      // object: maybe already keyed by place_id
      PLACES_BY_ID = pVal;
    }
  }

  if(!pkgRes.val){
    toast("Packages not found in Firebase. Check DB path.");
    PACKAGES = [];
  } else {
    PACKAGES = toArray(pkgRes.val);
  }

  $("pkgCount").textContent = `${PACKAGES.length} packages`;
  buildDistricts();
  renderPackages();
}

/* =========================================================
   Packages UI
========================================================= */
function buildDistricts(){
  const bar = $("districtBar");
  bar.innerHTML = "";

  const dset = new Set(["ALL"]);
  PACKAGES.forEach(p=>{
    const d = (p.district || p.District || p.dist || p.region || "").toString().trim();
    if(d) dset.add(d.toUpperCase());
  });
  const districts = Array.from(dset);

  districts.forEach(d=>{
    const el = document.createElement("div");
    el.className = "distItem" + (d===selectedDistrict ? " active":"");
    el.innerHTML = `<b>${d}</b>`;
    el.onclick = ()=>{
      selectedDistrict = d;
      $("pillDistrict").textContent = d;
      buildDistricts();
      renderPackages();
    };
    bar.appendChild(el);
  });

  $("pillDistrict").textContent = selectedDistrict;
}

function getPkgTitle(pkg){
  return pkg.name || pkg.package_name || pkg.title || "Untitled Package";
}
function getPkgDistrict(pkg){
  const d = pkg.district || pkg.District || pkg.dist || pkg.region || "";
  return String(d || "NA").toUpperCase();
}
function getPkgDays(pkg){
  return Number(pkg.days || pkg.total_days || pkg.duration || (pkg.itinerary?.length) || 0) || 0;
}
function getPkgCover(pkg){
  return pkg.cover || pkg.image || pkg.photo || pkg.banner || "";
}
function getPkgTagline(pkg){
  return pkg.tagline || pkg.subtitle || pkg.short || "";
}

function renderPackages(){
  const list = $("pkgList");
  list.innerHTML = "";

  const shown = PACKAGES.filter(p => selectedDistrict==="ALL" ? true : getPkgDistrict(p)===selectedDistrict);
  $("pkgCount").textContent = `${shown.length} packages`;

  const hdr = document.createElement("div");
  hdr.className = "pkgGroupHdr";
  hdr.innerHTML = `<div class="h1">Available Packages</div>
                   <div class="h2">Select a package to load day-wise (date-wise) itinerary + map pins.</div>`;
  list.appendChild(hdr);

  shown.forEach(pkg=>{
    const id = pkg.id || pkg.package_id || pkg.key || pkg.slug || getPkgTitle(pkg);
    const el = document.createElement("div");
    el.className = "pkg" + (id===selectedPackageId ? " active":"");
    const cover = getPkgCover(pkg);

    el.innerHTML = `
      <div class="pkgPic">${cover ? `<img src="${cover}" alt="">` : "HE"}</div>
      <div class="pkgBody">
        <div class="pkgName">${getPkgTitle(pkg)}</div>
        <div class="pkgMeta">${getPkgDistrict(pkg)} • ${getPkgDays(pkg) || (pkg.itinerary?.length || "—")} Days</div>
        <div class="diffLine">${getPkgTagline(pkg) || "Tap to view itinerary"}</div>
      </div>
    `;
    el.onclick = ()=> selectPackage(id, pkg);
    list.appendChild(el);
  });
}

/* =========================================================
   Itinerary rendering (Date-wise + All places visible)
========================================================= */
function normalizeDayWise(pkg){
  const raw = pkg.itinerary || pkg.day_wise || pkg.plan || pkg.days_plan || [];
  // object array case
  if(Array.isArray(raw) && raw.length && typeof raw[0] === "object"){
    return raw.map((d,i)=>({
      day: Number(d.day || d.dayIndex || (i+1)) || (i+1),
      places: d.places || d.place_ids || d.locations || d.stops || []
    }));
  }
  // array-of-arrays case
  if(Array.isArray(raw) && raw.length && Array.isArray(raw[0])){
    return raw.map((arr,i)=>({ day:i+1, places:arr }));
  }
  return [];
}

function selectPackage(id, pkg){
  selectedPackageId = id;
  $("pillSelected").textContent = "YES";
  renderPackages();

  $("itiHint").textContent = "Day-wise itinerary";
  $("itiTitle").textContent = getPkgTitle(pkg);
  $("itiSub").textContent = `District: ${getPkgDistrict(pkg)} • Tap any place for popup details`;

  const dayWise = normalizeDayWise(pkg);
  const totalPlaces = dayWise.reduce((s,d)=> s + (Array.isArray(d.places)?d.places.length:0), 0);

  $("statDays").textContent = String(dayWise.length || getPkgDays(pkg) || "—");
  $("statPlaces").textContent = String(totalPlaces || "—");

  renderItinerary(pkg);
  renderMapPinsForPackage(pkg);
}

function renderItinerary(pkg){
  const daysWrap = $("daysList");
  daysWrap.innerHTML = "";

  const dayWise = normalizeDayWise(pkg);
  if(!dayWise.length){
    daysWrap.innerHTML = `<div class="dayCard"><div class="muted" style="text-transform:none;">No itinerary found in this package data.</div></div>`;
    return;
  }

  const tripDateVal = $("tripDate").value;
  const startDateISO = tripDateVal ? (tripDateVal + "T00:00:00") : null;

  dayWise.forEach((dayObj, idx)=>{
    const card = document.createElement("div");
    card.className = "dayCard";

    const dateLabel = startDateISO ? fmtDateForDay(startDateISO, idx) : "Select Start Date";

    card.innerHTML = `
      <div class="dayTop">
        <div class="d">DAY ${dayObj.day}</div>
        <div class="dateTag">${dateLabel}</div>
      </div>
      <div class="muted">All places for this date are listed below.</div>
    `;

    const pids = Array.isArray(dayObj.places) ? dayObj.places : [];
    if(!pids.length){
      const empty = document.createElement("div");
      empty.className = "muted";
      empty.style.textTransform = "none";
      empty.textContent = "No places added for this day.";
      card.appendChild(empty);
    } else {
      pids.forEach(pid=>{
        const place = PLACES_BY_ID[pid] || PLACES_BY_ID[String(pid)] || null;
        const name = place?.name || place?.title || pid;
        const district = (place?.district || place?.District || "").toString().toUpperCase();
        const category = (place?.category || place?.Category || place?.type || "").toString().toUpperCase();
        const img = place?.image_url || place?.image || place?.photo || place?.cover || "";

        const line = document.createElement("div");
        line.className = "placeLine";
        line.innerHTML = `
          <div class="thumb">${img ? `<img src="${img}" alt="">` : (String(name).slice(0,1) || "?")}</div>
          <div class="pinfo">
            <div class="pname">${String(name)}</div>
            <div class="pmeta">${[district, category].filter(Boolean).join(" • ") || "Tap for details"}</div>
          </div>
        `;
        line.onclick = ()=> openPlaceModal(pid, place, { day: dayObj.day, dateLabel });
        card.appendChild(line);
      });
    }

    daysWrap.appendChild(card);
  });
}

/* =========================================================
   Place popup
========================================================= */
function openPlaceModal(pid, placeObj, ctx){
  const place = placeObj || PLACES_BY_ID[pid] || {};
  const name = place.name || place.title || pid;

  $("modalTitle").textContent = String(name);

  const history = place.history || place.history_tagline || place.about || "—";
  $("modalAbout").textContent = String(history);

  const bullets = splitBulletsSmart(place.what_you_find || place.what || place.features || "");
  const ul = $("modalBullets");
  ul.innerHTML = "";
  if(bullets.length){
    bullets.forEach(b=>{
      const li = document.createElement("li");
      li.textContent = b;
      ul.appendChild(li);
    });
  } else {
    const li = document.createElement("li");
    li.textContent = "—";
    ul.appendChild(li);
  }

  const lat = place.latitude ?? place.lat;
  const lng = place.longitude ?? place.lng ?? place.lon;

  const district = (place.district || place.District || "").toString().toUpperCase();
  const category = (place.category || place.Category || place.type || "").toString().toUpperCase();

  $("modalMeta").textContent =
    `Day: ${ctx?.day ?? "—"} • Date: ${ctx?.dateLabel ?? "—"} • District: ${district || "—"} • Category: ${category || "—"} • LatLng: ${(lat && lng) ? (lat + ", " + lng) : "—"}`;

  const img = place.image_url || place.image || place.photo || place.cover || "";
  const imgEl = $("modalImg");
  imgEl.style.display = img ? "block" : "none";
  imgEl.src = img || "";

  $("placeModal").classList.add("show");
  $("placeModal").setAttribute("aria-hidden", "false");
}

function closePlaceModal(){
  $("placeModal").classList.remove("show");
  $("placeModal").setAttribute("aria-hidden", "true");
}

/* =========================================================
   Map pins for package
========================================================= */
function renderMapPinsForPackage(pkg){
  markersLayer.clearLayers();
  routeLayer.setLatLngs([]);

  const dayWise = normalizeDayWise(pkg);
  const pids = Array.from(new Set(dayWise.flatMap(d => Array.isArray(d.places)?d.places:[])));

  const latlngs = [];

  pids.forEach(pid=>{
    const p = PLACES_BY_ID[pid] || null;
    if(!p) return;

    const lat = Number(p.latitude ?? p.lat);
    const lng = Number(p.longitude ?? p.lng ?? p.lon);
    if(!isFinite(lat) || !isFinite(lng)) return;

    const ll = [lat, lng];
    latlngs.push(ll);

    const name = p.name || p.title || pid;

    const m = L.marker(ll).addTo(markersLayer);
    m.bindPopup(`<b>${String(name)}</b><br><small>Tap place in itinerary for details</small>`);
  });

  if(latlngs.length){
    routeLayer.setLatLngs(latlngs);
    map.fitBounds(L.latLngBounds(latlngs).pad(0.25));
    $("mapStatus").textContent = `Pins: ${latlngs.length}`;
  } else {
    $("mapStatus").textContent = "No pins";
  }
}

/* =========================================================
   Init
========================================================= */
function setDefaultDateToday(){
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth()+1).padStart(2,"0");
  const dd = String(now.getDate()).padStart(2,"0");
  $("tripDate").value = `${yyyy}-${mm}-${dd}`;
}

function initUI(){
  setDefaultDateToday();
  initMap();

  $("generateBtn").addEventListener("click", ()=>{
    if(!selectedPackageId){
      toast("Select a package first.");
      return;
    }
    // Re-render itinerary date-wise
    const pkg = PACKAGES.find(p => (p.id||p.package_id||p.key||p.slug|| (p.name||p.title)) === selectedPackageId) || null;
    if(pkg) renderItinerary(pkg);
    toast("Itinerary updated date-wise.");
  });

  $("resetBtn").addEventListener("click", ()=>{
    $("startPoint").value = "Delhi";
    $("persons").value = 2;
    toast("Reset done.");
  });

  $("chipHelp").addEventListener("click", ()=>{
    toast("Select package → day-wise places show. Change date → date labels update. Tap place → popup details.");
  });

  $("chipClear").addEventListener("click", ()=>{
    selectedPackageId = null;
    $("pillSelected").textContent = "None";
    $("itiHint").textContent = "Select a package";
    $("itiTitle").textContent = "No package selected";
    $("itiSub").textContent = "Choose a package from the left to see day-wise places (date-wise). Tap any place for popup details.";
    $("statDays").textContent = "—";
    $("statPlaces").textContent = "—";
    $("daysList").innerHTML = "";
    markersLayer.clearLayers();
    routeLayer.setLatLngs([]);
    $("mapStatus").textContent = "Ready";
    renderPackages();
    toast("Selection cleared.");
  });

  $("modalClose").addEventListener("click", closePlaceModal);
  $("placeModal").addEventListener("click", (e)=>{
    if(e.target.id === "placeModal") closePlaceModal();
  });
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") closePlaceModal();
  });

  $("tripDate").addEventListener("change", ()=>{
    if(!selectedPackageId) return;
    const pkg = PACKAGES.find(p => (p.id||p.package_id||p.key||p.slug|| (p.name||p.title)) === selectedPackageId) || null;
    if(pkg) renderItinerary(pkg);
  });
}

initUI();
loadFirebaseData();
</script>

</body>
</html>