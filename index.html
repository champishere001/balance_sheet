<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="color-scheme" content="light"/>
  <title>Himachal Explorer | Choose Your Travel Origin</title>
  <meta name="description" content="Choose your travel origin and explore Himachal tour packages with live routes, itineraries, places and instant estimates."/>
  <meta name="theme-color" content="#EAF3FF"/>
  <link rel="icon" href="./favicon.ico"/>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#EEF6FF; --bg2:#EAF0FF; --stroke:#D7E6FF;
      --text:#0D1B2A; --muted:#5D728A;
      --card:#FFFFFFCC; --shadow: 0 18px 45px rgba(12,34,70,.16);
      --r:22px; --max:1080px; --primary:#2F7BFF; --primary2:#5AA9FF;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 10%, #FFFFFF 0%, rgba(255,255,255,0) 55%),
        radial-gradient(900px 600px at 85% 20%, rgba(155,197,255,.35) 0%, rgba(155,197,255,0) 55%),
        linear-gradient(180deg, var(--bg2) 0%, var(--bg1) 55%, #F7FBFF 100%);
      color:var(--text);
    }
    .wrap{width:min(var(--max),92vw); margin:22px auto 34px; display:flex; flex-direction:column; gap:18px;}

    .hero{
      border-radius:var(--r); overflow:hidden; border:1px solid var(--stroke);
      box-shadow:var(--shadow); background:rgba(255,255,255,.35); position:relative;
      min-height:220px;
    }

    /* ✅ One-frame collage (all pics visible together) */
    .slidesGrid{
      position:absolute; inset:0;
      display:grid;
      gap:8px;
      padding:10px;
      background: rgba(255,255,255,.22);

      grid-template-columns: 1.35fr 1fr;
      grid-template-rows: repeat(3, 1fr);
    }
    .slidesGrid .tile{
      border-radius:18px;
      background-size:cover;
      background-position:center;
      border: 1px solid rgba(215,230,255,.85);
      box-shadow: 0 10px 22px rgba(12,34,70,.08);
      position:relative;
      overflow:hidden;
    }
    .slidesGrid .tile::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.22));
      pointer-events:none;
    }
    .slidesGrid .tile:nth-child(1){
      grid-column: 1 / 2;
      grid-row: 1 / 4;
    }

    /* Overlay for readability */
    .hero:after{
      content:""; position:absolute; inset:0;
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.66));
      pointer-events:none;
    }

    .heroContent{
      position:relative;
      padding:16px;
      min-height:220px;
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
      gap:10px;
    }

    .brandRow{
      display:flex; align-items:center; gap:12px; width:fit-content; max-width:100%;
      background:rgba(255,255,255,.78); border:1px solid rgba(215,230,255,.9);
      border-radius:18px; padding:10px 12px; box-shadow:0 10px 25px rgba(12,34,70,.10);
      backdrop-filter:blur(10px);
    }
    .logo{width:48px; height:48px; border-radius:14px; overflow:hidden; border:1px solid rgba(210,225,255,.9); background:#fff}
    .logo img{width:100%; height:100%; object-fit:cover; display:block}
    .brandName{font-weight:800; letter-spacing:.12em; text-transform:uppercase; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .tagline{font-size:12px; color:#7B8DA3; letter-spacing:.12em; text-transform:uppercase; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; margin-top:2px;}

    .card{
      border-radius:calc(var(--r) + 2px); border:1px solid var(--stroke);
      background:var(--card); box-shadow:var(--shadow); overflow:hidden;
    }
    .cardInner{padding:18px;}

    .note{margin-top:10px; font-size:12px; color:rgba(25,40,65,.72); text-align:center}

    footer{
      border-radius:var(--r); border:1px solid rgba(215,230,255,.95);
      background:rgba(255,255,255,.55); box-shadow:0 10px 25px rgba(12,34,70,.10);
      padding:14px 16px; display:flex; flex-wrap:wrap; gap:10px 14px;
      align-items:center; justify-content:space-between;
    }
    .pill{font-size:12px; color:#27415c; border:1px solid rgba(210,225,255,.95);
      background:#fff; padding:8px 10px; border-radius:999px; text-decoration:none}

    /* ✅ Mobile collage layout */
    @media (max-width:820px){
      .slidesGrid{
        grid-template-columns: 1fr;
        grid-template-rows: 1.2fr repeat(4, .8fr);
      }
      .slidesGrid .tile:nth-child(1){
        grid-column: 1 / 2;
        grid-row: 1 / 2;
      }
    }

    /* ===== Moved from dashboard: slideshow hero ===== */
    .indexShowHero{
      border-radius: var(--r);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      height: clamp(220px, 26vw, 320px);
    }
    .indexShowHero img{
      width:100%; height:100%;
      object-fit:cover; display:block;
      filter:saturate(1.05) contrast(1.02);
      transition: opacity .5s ease;
    }
    .indexShowHero:before{
      content:""; position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(255,255,255,.30), rgba(255,255,255,.08), rgba(255,255,255,.44));
      pointer-events:none;
    }
    .indexShowHeroContent{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      text-align:center;
      padding:14px;
      gap:10px;
    }
    .ihTag{
      border:1px solid rgba(215,230,255,.95);
      background: rgba(255,255,255,.72);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 11px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: rgba(13,27,42,.88);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 22px rgba(12,34,70,.10);
    }
    .ihH{
      font-size: clamp(16px, 2.2vw, 22px);
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(13,27,42,.92);
    }
    .ihP{
      max-width: 680px;
      font-size: 12px;
      color: rgba(13,27,42,.72);
      letter-spacing:.08em;
      text-transform: uppercase;
      line-height: 1.55;
    }

    /* ===== Dropdown selector UI ===== */
    .selectWrap{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:10px;
      align-items:flex-end;
    }
    .field{
      flex: 1 1 260px;
      min-width: 240px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .label{
      font-size:12px;
      font-weight:900;
      letter-spacing:.14em;
      text-transform:uppercase;
      color: rgba(13,27,42,.78);
    }

    .select{
      position:relative;
    }
    select{
      width:100%;
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      padding: 12px 42px 12px 14px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      outline:none;
      font-weight:800;
      letter-spacing:.06em;
      text-transform:uppercase;
      background: rgba(255,255,255,.86);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.7), 0 10px 22px rgba(12,34,70,.08);
      cursor:pointer;
    }
    .chev{
      position:absolute;
      right:12px;
      top:50%;
      transform:translateY(-50%);
      pointer-events:none;
      width:28px; height:28px;
      border-radius:10px;
      border:1px solid rgba(210,225,255,.95);
      background: rgba(255,255,255,.8);
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 8px 18px rgba(12,34,70,.08);
      font-weight:900;
      color: rgba(13,27,42,.8);
    }

    .btn{
      border:none; border-radius:14px;
      padding:12px 14px;
      font-weight:900; letter-spacing:.10em; text-transform:uppercase;
      cursor:pointer; display:flex; align-items:center; justify-content:center; gap:10px;
      transition:transform .12s ease, box-shadow .2s ease;
      height: 44px;
    }
    .btn:active{transform:translateY(1px)}
    .btnPrimary{background:linear-gradient(135deg,var(--primary),var(--primary2)); color:#fff; box-shadow:0 10px 22px rgba(47,123,255,.22)}
    .btnGhost{background:#fff; color:#0D1B2A; border:1px solid rgba(210,225,255,.95); box-shadow:0 8px 18px rgba(12,34,70,.08)}

    /* ===== District section ===== */
    .districtCard{
      border-radius:calc(var(--r) + 2px);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .districtInner{ padding:18px; }
    .districtHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .districtTitle{
      font-size:14px;
      font-weight:900;
      letter-spacing:.14em;
      text-transform:uppercase;
      margin:0;
    }
    .districtSub{
      margin:6px 0 0;
      font-size:12px;
      color: rgba(13,27,42,.70);
      letter-spacing:.04em;
    }
    .districtGrid{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }
    .dItem{
      border-radius:18px;
      border:1px solid rgba(210,225,255,.95);
      background: rgba(255,255,255,.82);
      box-shadow: 0 10px 22px rgba(12,34,70,.08);
      padding:12px;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, box-shadow .2s ease;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-height:86px;
    }
    .dItem:active{ transform: translateY(1px); }
    .dName{
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:12px;
    }
    .dMeta{
      font-size:12px;
      color: rgba(13,27,42,.66);
      line-height:1.35;
    }
    .districtBar{
      display:flex;
      gap:10px;
      align-items:flex-end;
      flex-wrap:wrap;
    }
    .districtBar .field{ flex: 1 1 340px; }

    @media (max-width:980px){
      .districtGrid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width:520px){
      .districtGrid{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="wrap">

    <!-- Top collage hero (kept) -->
    <section class="hero">
      <div class="slidesGrid">
        <div class="tile" style="background-image:url('./style/images/kunjum.jpg')"></div>
        <div class="tile" style="background-image:url('./style/images/kinnaur-kailash.webp')"></div>
        <div class="tile" style="background-image:url('./style/images/Travelers.jpg')"></div>
        <div class="tile" style="background-image:url('./style/images/n1.jpg')"></div>
        <div class="tile" style="background-image:url('./style/images/activity.jpg')"></div>
      </div>

      <div class="heroContent">
        <div class="brandRow">
          <div class="logo"><img src="./style/images/logo.png" alt="Logo" onerror="this.style.display='none'"></div>
          <div>
            <div class="brandName">Himachal Explorer</div>
            <div class="tagline">Choose your travel origin</div>
          </div>
        </div>
        <div class="note">Select Mode (dropdown) → Select Start City (dropdown) → Enter Dashboard.</div>
      </div>
    </section>

    <!-- ✅ Slideshow hero -->
    <section class="indexShowHero" id="indexShowHero">
      <img id="indexHeroImg" src="./style/images/kinnaur-kailash.webp" alt="Himachal Explorer" onerror="this.src='./style/images/n1.jpg'">
      <div class="indexShowHeroContent">
        <div class="ihTag">Himachal Explorer</div>
        <div class="ihH">Discover Himachal Pradesh</div>
        <div class="ihP">Mountains • Valleys • Temples • Treks • Hidden Places • Road Trips</div>
        <div class="ihTag" id="indexModeTag">Choose mode below</div>
      </div>
    </section>

    <!-- ✅ Mode + Start as DROPDOWNS -->
    <section class="card">
      <div class="cardInner">

        <div class="selectWrap">
          <div class="field">
            <div class="label">Travel Mode</div>
            <div class="select">
              <select id="modeSelect">
                <option value="" selected>SELECT MODE</option>
                <option value="within">WITHIN HIMACHAL</option>
                <option value="outside">OUTSIDE HIMACHAL</option>
              </select>
              <div class="chev">⌄</div>
            </div>
          </div>

          <div class="field">
            <div class="label">Start City / Pickup</div>
            <div class="select">
              <select id="startSelect" disabled>
                <option value="" selected>SELECT START CITY</option>
              </select>
              <div class="chev">⌄</div>
            </div>
          </div>

          <button class="btn btnPrimary" id="goDash" type="button">Enter Dashboard →</button>
        </div>

        <div class="note" id="dbHint">We will load database here (index) and carry it to dashboard.</div>
        <div class="note" id="startHint" style="margin-top:8px;">Tip: pick a mode to load start locations.</div>
      </div>
    </section>

    <!-- ✅ District Section -->
    <section class="districtCard" id="districtSection">
      <div class="districtInner">
        <div class="districtHead">
          <div>
            <h3 class="districtTitle">Explore Districts</h3>
            <div class="districtSub">Choose a district to quickly open its guide page (you can link these later).</div>
          </div>

          <div class="districtBar">
            <div class="field" style="min-width:260px;">
              <div class="label">District</div>
              <div class="select">
                <select id="districtSelect">
                  <option value="" selected>SELECT DISTRICT</option>
                </select>
                <div class="chev">⌄</div>
              </div>
            </div>

            <button class="btn btnGhost" id="openDistrict" type="button">Open District →</button>
          </div>
        </div>

        <div class="districtGrid" id="districtGrid"></div>
      </div>
    </section>

    <footer>
      <a class="pill" href="#" onclick="window.scrollTo({top:0,behavior:'smooth'});return false;">Top</a>
      <span class="pill">© <span id="yy"></span> Himachal Explorer</span>
    </footer>
  </main>

  <!-- Firebase (Compat) - ONLY on index -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>

  <script>
    /* =========================================================
       INDEX (index.html)
       ✅ Firebase load here only
       ✅ Save templates+places+costs in sessionStorage
       ✅ Dashboard never fetches Firebase
       ========================================================= */

    const firebaseConfig = {
      apiKey: "AIzaSyAKaFrj7JobWLloNQqzvx3SSibyrsiwzug",
      authDomain: "revnue-records.firebaseapp.com",
      databaseURL: "https://revnue-records-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "revnue-records",
      storageBucket: "revnue-records.firebasestorage.app",
      messagingSenderId: "182348503564",
      appId: "1:182348503564:web:480085405b0917724d9fce",
      measurementId: "G-9J5JQFDX4R"
    };

    const NODE_TEMPLATES  = "templates";
    const NODE_PLACES     = "places";
    const NODE_COSTS      = "package_cost_breakdown";

    const $ = (id)=>document.getElementById(id);

    let SELECTED_MODE = null;  // "within" | "outside"
    let DB_LOADED = false;
    let TPL_ARR = null;        // array templates
    let STARTS = [];           // start select values

    function isLocalComputed(tpl){
      const routeId = String(tpl.route_id || "").toUpperCase().trim();
      const regionStyle = String(tpl.region_style || "").toLowerCase().trim();
      const pkgId = String(tpl.package_id || tpl.key || "").toLowerCase();
      return regionStyle === "local" || routeId.endsWith("-LCL") || pkgId.includes("-local");
    }

    async function waitFirebase(){
      for(let i=0;i<60;i++){
        if(window.firebase && firebase.initializeApp) return true;
        await new Promise(r=>setTimeout(r, 50));
      }
      return false;
    }

    async function dbGet(db, path){
      return new Promise((resolve)=>{
        db.ref(path).once("value", (snap)=> resolve(snap.val()));
      });
    }

    function updateIndexModeTag(mode){
      const tag = $("indexModeTag");
      if(!tag) return;
      if(mode === "within") tag.textContent = "Mode: Within Himachal";
      else if(mode === "outside") tag.textContent = "Mode: Outside Himachal";
      else tag.textContent = "Choose mode below";
    }

    // Slideshow
    const INDEX_HERO_IMAGES = [
      "./style/images/kinnaur-kailash.webp",
      "./style/images/n1.jpg",
      "./style/images/temple.jpg",
      "./style/images/trek.jpeg"
    ];
    let heroIdx = 0;
    function startIndexHero(){
      const img = $("indexHeroImg");
      if(!img) return;
      setInterval(()=>{
        heroIdx = (heroIdx + 1) % INDEX_HERO_IMAGES.length;
        img.style.opacity = 0;
        setTimeout(()=>{
          img.src = INDEX_HERO_IMAGES[heroIdx];
          img.style.opacity = 1;
        }, 250);
      }, 4200);
    }

    async function ensureDatabaseLoaded(){
      if(DB_LOADED) return true;

      const hint = $("startHint");
      hint.textContent = "Connecting to database…";

      const ok = await waitFirebase();
      if(!ok){
        hint.textContent = "Firebase script not loaded. Check internet / script blocked.";
        return false;
      }

      if(!firebase.apps || !firebase.apps.length){
        firebase.initializeApp(firebaseConfig);
      }
      const db = firebase.database();

      hint.textContent = "Loading templates…";
      const templates = await dbGet(db, NODE_TEMPLATES) || {};
      hint.textContent = "Loading places…";
      const places = await dbGet(db, NODE_PLACES) || {};
      hint.textContent = "Loading pricing…";
      const costs = await dbGet(db, NODE_COSTS) || {};

      TPL_ARR = Object.entries(templates).map(([k,v])=>({ key:k, ...(v||{}) }));

      try{
        sessionStorage.setItem("HX_TEMPLATES", JSON.stringify(templates));
        sessionStorage.setItem("HX_PLACES", JSON.stringify(places));
        sessionStorage.setItem("HX_COSTS", JSON.stringify(costs));
        sessionStorage.setItem("HX_SAVED_AT", String(Date.now()));
      }catch(e){
        console.warn("sessionStorage save failed:", e);
      }

      DB_LOADED = true;
      hint.textContent = "Database loaded ✅";
      $("dbHint").textContent = "Database loaded on index ✅ Dashboard will use this data (no Firebase fetch).";
      return true;
    }

    function buildStartDropdownForMode(mode){
      if(!TPL_ARR) return;

      const wantLocal = (mode === "within");
      const starts = new Set();

      TPL_ARR.forEach(t=>{
        const s = String(t.start_point || t.start || "").trim();
        if(!s) return;
        const local = isLocalComputed(t);
        if(wantLocal && !local) return;
        if(!wantLocal && local) return;
        starts.add(s.toUpperCase());
      });

      STARTS = Array.from(starts).sort((a,b)=>a.localeCompare(b));

      const sel = $("startSelect");
      sel.innerHTML = `<option value="" selected>SELECT START CITY</option>`;
      STARTS.forEach(v=>{
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        sel.appendChild(opt);
      });

      sel.disabled = false;

      $("startHint").textContent =
        mode === "within"
          ? `Within Himachal: ${STARTS.length} start locations`
          : `Outside Himachal: ${STARTS.length} start locations`;
    }

    async function selectMode(mode){
      SELECTED_MODE = mode || null;
      localStorage.setItem("travel_origin", SELECTED_MODE || "");
      updateIndexModeTag(SELECTED_MODE);

      // reset start select until loaded
      $("startSelect").disabled = true;
      $("startSelect").innerHTML = `<option value="" selected>SELECT START CITY</option>`;

      if(!SELECTED_MODE){
        $("startHint").textContent = "Tip: pick a mode to load start locations.";
        return;
      }

      const ok = await ensureDatabaseLoaded();
      if(ok) buildStartDropdownForMode(SELECTED_MODE);
    }

    function goDashboard(){
      const start = String($("startSelect").value || "").trim();
      if(!SELECTED_MODE){
        alert("Please select a Travel Mode first.");
        $("modeSelect").focus();
        return;
      }
      if(!start){
        alert("Please select a Start City / Pickup.");
        $("startSelect").focus();
        return;
      }
      location.href = "./dashboard.html?mode=" + encodeURIComponent(SELECTED_MODE) + "&start=" + encodeURIComponent(start);
    }

    // ===== District section (static list now; link later) =====
    const DISTRICTS_HP = [
      { id:"bilaspur", name:"Bilaspur", meta:"Lakes • Forts • Temples" },
      { id:"chamba", name:"Chamba", meta:"Valleys • Heritage • Lakes" },
      { id:"hamirpur", name:"Hamirpur", meta:"Temples • Culture • Local routes" },
      { id:"kangra", name:"Kangra", meta:"Dharamshala • Temples • Tea gardens" },
      { id:"kinnaur", name:"Kinnaur", meta:"High mountains • Apple belt" },
      { id:"kullu", name:"Kullu", meta:"Manali • Valleys • Adventure" },
      { id:"lahaul-spiti", name:"Lahaul & Spiti", meta:"Cold desert • Monasteries" },
      { id:"mandi", name:"Mandi", meta:"River towns • Temples" },
      { id:"shimla", name:"Shimla", meta:"Hill station • Heritage • Nearby treks" },
      { id:"sirmaur", name:"Sirmaur", meta:"Peaks • Forts • Lakes" },
      { id:"solan", name:"Solan", meta:"Monasteries • Gardens" },
      { id:"una", name:"Una", meta:"Pilgrimage • Plains gateway" }
    ];

    function initDistrictUI(){
      const sel = $("districtSelect");
      const grid = $("districtGrid");
      if(!sel || !grid) return;

      sel.innerHTML = `<option value="" selected>SELECT DISTRICT</option>`;
      DISTRICTS_HP.forEach(d=>{
        const opt = document.createElement("option");
        opt.value = d.id;
        opt.textContent = d.name.toUpperCase();
        sel.appendChild(opt);
      });

      grid.innerHTML = "";
      DISTRICTS_HP.forEach(d=>{
        const div = document.createElement("div");
        div.className = "dItem";
        div.innerHTML = `
          <div class="dName">${d.name}</div>
          <div class="dMeta">${d.meta}</div>
        `;
        div.onclick = ()=>{
          sel.value = d.id;
          openDistrict();
        };
        grid.appendChild(div);
      });
    }

    function openDistrict(){
      const id = String($("districtSelect").value || "").trim();
      if(!id){
        alert("Please select a district.");
        $("districtSelect").focus();
        return;
      }
      // ✅ You can change this path later to your real district pages
      // Example: ./districts/shimla.html or ./district.html?id=shimla
      location.href = "./district.html?id=" + encodeURIComponent(id);
    }

    // events
    $("modeSelect").addEventListener("change", (e)=> selectMode(e.target.value));
    $("goDash").onclick = goDashboard;
    $("openDistrict").onclick = openDistrict;

    $("yy").textContent = new Date().getFullYear();
    startIndexHero();
    initDistrictUI();

    // restore mode if saved
    const savedMode = (localStorage.getItem("travel_origin") || "").trim();
    if(savedMode === "within" || savedMode === "outside"){
      $("modeSelect").value = savedMode;
      selectMode(savedMode);
    }
  </script>
</body>
</html>