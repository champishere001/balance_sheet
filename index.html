<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Himachal Explorer — Firebase + Route Planner</title>

  <style>
    :root{
      --bg:#070a12; --stroke: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92); --muted: rgba(255,255,255,.72);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --r: 18px; --r2: 26px;
      --ok:#49f2c2; --warn:#ffcf5a; --bad:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% 10%, rgba(120,120,255,.18), transparent 60%),
                  radial-gradient(1200px 800px at 80% 30%, rgba(0,255,200,.10), transparent 55%),
                  var(--bg);
      overflow-x:hidden;
    }
    .bg{
      position:fixed; inset:0;
      background:
        linear-gradient(180deg, rgba(5,8,16,.62), rgba(5,8,16,.86)),
        url("https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=2400&q=80");
      background-size:cover; background-position:center;
      z-index:-2; filter:saturate(1.08) contrast(1.05);
    }

    .wrap{display:grid; grid-template-columns: 310px 1fr; gap:18px; padding:18px; min-height:100vh;}

    .side{
      position:sticky; top:18px; align-self:start; height: calc(100vh - 36px);
      border-radius: var(--r2);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      backdrop-filter: blur(14px);
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      padding:18px; overflow:auto;
    }
    .brand{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .logo{
      width:46px;height:46px;border-radius:16px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.22), rgba(255,255,255,.06));
      border:1px solid var(--stroke); display:grid; place-items:center;
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .brand h1{margin:0;font-size:15px;letter-spacing:.3px;line-height:1.15}
    .brand p{margin:2px 0 0 0;font-size:12px;color:var(--muted)}

    .nav{display:grid;gap:10px;margin:14px 0 16px}
    .nav button{
      width:100%; text-align:left;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:12px; border-radius:14px; cursor:pointer;
      display:flex; align-items:center; justify-content:space-between;
      transition:.22s ease;
    }
    .nav button:hover{transform:translateY(-1px);background: rgba(255,255,255,.10)}
    .nav button.active{background: rgba(255,255,255,.14);border-color: rgba(255,255,255,.22)}
    .nav small{color:var(--muted);font-weight:600}

    .panelTitle{
      margin:14px 0 8px; font-size:12px; letter-spacing:.28em;
      text-transform:uppercase; color:rgba(255,255,255,.70);
    }
    .field{display:grid;gap:8px;margin-bottom:12px}
    label{font-size:12px;color:rgba(255,255,255,.76)}
    input, select{
      width:100%; padding:12px; border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(8,12,20,.55);
      color:var(--text); outline:none;
    }
    input::placeholder{color:rgba(255,255,255,.55)}

    .chipRow{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .chip{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:rgba(255,255,255,.88);
      padding:8px 10px; border-radius:999px;
      cursor:pointer; font-size:12px; transition:.2s ease; user-select:none;
    }
    .chip:hover{background: rgba(255,255,255,.10);transform:translateY(-1px)}
    .chip.on{background: rgba(255,255,255,.14);border-color: rgba(255,255,255,.22)}

    .miniCard{
      margin-top:12px; border-radius: var(--r);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding:12px;
    }
    .miniCard p{margin:6px 0 0 0;color:var(--muted);font-size:12px;line-height:1.45}

    .btn{
      width:100%; margin-top:10px; padding:12px;
      border-radius:14px; border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.12); color:var(--text);
      cursor:pointer; transition:.2s ease; font-weight:650;
    }
    .btn:hover{transform:translateY(-1px);background: rgba(255,255,255,.18)}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .toggleRow{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .toggleRow input{width:auto}

    .hint{
      margin-top:10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
      white-space:pre-wrap;
    }
    .hint b{color:rgba(255,255,255,.9)}
    .pillMini{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-weight:750; font-size:12px;
      margin-top:8px;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--ok);display:inline-block}

    .main{
      border-radius: var(--r2);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      display:flex; flex-direction:column;
      min-height: calc(100vh - 36px);
    }
    .hero{
      padding:20px 20px 14px;
      background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.02));
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .heroTop{display:flex;gap:12px;justify-content:space-between;align-items:flex-end;flex-wrap:wrap}
    .hero h2{margin:0;font-size:26px;line-height:1.15}
    .hero p{margin:8px 0 0;color:var(--muted);max-width:66ch;line-height:1.5}

    .searchBar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:14px}
    .searchBar input{flex:1 1 320px;min-width:240px;background: rgba(0,0,0,.28)}
    .ghost{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color:var(--text);
      padding:11px 12px; border-radius:14px;
      cursor:pointer; font-weight:800; transition:.2s ease;
    }
    .ghost:hover{background: rgba(255,255,255,.14);transform:translateY(-1px)}

    .split{display:grid; grid-template-columns: 1.35fr .85fr; gap:14px; padding:14px; flex:1; min-height:0;}
    .leftPane, .rightPane{
      border-radius: 22px; border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18); overflow:hidden; min-height:0;
    }
    .paneHead{
      padding:12px; border-bottom:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background: rgba(255,255,255,.05);
    }
    .paneHead strong{font-size:13px}
    .paneHead small{color:var(--muted)}
    .paneBody{padding:12px; overflow:auto; height:100%}

    .grid{display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:12px}
    .card{
      border-radius: 22px; overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      box-shadow: 0 18px 55px rgba(0,0,0,.30);
      cursor:pointer;
      transition: transform .22s ease, background .22s ease, border-color .22s ease;
      min-height: 280px;
      position:relative;
    }
    .card:hover{transform:translateY(-3px);background: rgba(255,255,255,.10);border-color: rgba(255,255,255,.20)}
    .thumb{height:170px;background-size:cover;background-position:center;position:relative}
    .thumb:after{content:"";position:absolute;inset:0;background: linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.65))}
    .badge{
      position:absolute; left:12px; top:12px;
      padding:8px 10px; border-radius:999px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.18);
      font-size:12px; z-index:1; backdrop-filter: blur(10px);
    }
    .cardBody{padding:12px 12px 14px;display:grid;gap:8px}
    .titleRow{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .card h3{margin:0;font-size:15px;line-height:1.2}
    .meta{margin:0;color:var(--muted);font-size:12px;line-height:1.35}
    .pill{font-size:11px;padding:7px 9px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background: rgba(255,255,255,.06)}
    .submeta{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .subpill{font-size:11px;padding:6px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background: rgba(0,0,0,.16);color:rgba(255,255,255,.88)}
    .miniAdd{
      margin-left:auto;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.12);
      padding:7px 10px;
      border-radius:999px;
      font-weight:950;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .miniAdd:hover{background: rgba(255,255,255,.18)}
    .miniAdd.disabled{opacity:.55; cursor:not-allowed}

    .routeStats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
    .stat{border-radius:16px;border:1px solid rgba(255,255,255,.12);background: rgba(255,255,255,.06);padding:10px}
    .stat b{display:block;font-size:13px}
    .stat span{color:var(--muted);font-size:12px}

    #map{
      height:280px; border-radius:18px; border:1px solid rgba(255,255,255,.12);
      background:#0b1220; overflow:hidden; display:grid; place-items:center;
      color:rgba(255,255,255,.75); font-size:12px; text-align:center; padding:10px;
    }

    .routeList{display:grid;gap:10px;margin-top:10px}
    .routeItem{border-radius:18px;border:1px solid rgba(255,255,255,.12);background: rgba(255,255,255,.06);overflow:hidden}
    .routeItemHead{padding:10px;display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .routeItemHead b{font-size:13px;line-height:1.2}
    .routeItemHead p{margin:4px 0 0;color:var(--muted);font-size:12px}
    .routeBtns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .tiny{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      color:var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:800;
      transition:.2s ease;
      font-size:12px; line-height:1; user-select:none;
    }
    .tiny:hover{background: rgba(255,255,255,.16);transform:translateY(-1px)}

    .itinerary{
      margin-top:12px;border-radius:18px;border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18); padding:10px;
    }
    .itinerary h4{margin:0 0 8px;font-size:13px}
    .itinerary .day{
      border-radius:14px;border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      padding:10px;margin-bottom:8px;
    }
    .itinerary .day:last-child{margin-bottom:0}
    .itinerary .day b{font-size:12px}
    .itinerary .day p{margin:6px 0 0;color:var(--muted);font-size:12px;line-height:1.4}

    @media (max-width: 1180px){ .split{grid-template-columns:1fr} .grid{grid-template-columns: repeat(2, minmax(0,1fr))} }
    @media (max-width: 1050px){ .wrap{grid-template-columns:1fr} .side{position:relative;height:auto} }
    @media (max-width: 620px){ .wrap{padding:12px} .grid{grid-template-columns:1fr} .hero h2{font-size:22px} #map{height:260px} }
  </style>
</head>

<body>
  <div class="bg"></div>

  <div class="wrap">
    <!-- Sidebar -->
    <aside class="side">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 20h18" stroke="white" opacity=".85" stroke-width="2" stroke-linecap="round"/>
            <path d="M5 18l7-13 7 13" stroke="white" opacity=".9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 14h6" stroke="white" opacity=".85" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>Himachal Explorer</h1>
          <p>Realtime DB + Route Planner</p>
        </div>
      </div>

      <div class="nav" id="nav">
        <button class="active" data-tab="all">All <small>Everything</small></button>
        <button data-tab="Destination">Destinations <small>Explore</small></button>
        <button data-tab="Hotel">Hotels <small>Stay</small></button>
        <button data-tab="Temple">Temples <small>Faith</small></button>
      </div>

      <div class="panelTitle">Filters</div>
      <div class="field">
        <label>District</label>
        <select id="district"><option value="all">All Himachal</option></select>
      </div>
      <div class="field">
        <label>Search</label>
        <input id="q" placeholder="The Ridge, Jakhu..." />
      </div>

      <div class="panelTitle">Quick Tags <span style="opacity:.7; font-weight:700; letter-spacing:0; text-transform:none;">(optional)</span></div>
      <div class="chipRow" id="chipsSide">
        <!-- ✅ All OFF by default -->
        <div class="chip" data-chip="family">Family</div>
        <div class="chip" data-chip="nature">Nature</div>
        <div class="chip" data-chip="spiritual">Spiritual</div>
        <div class="chip" data-chip="heritage">Heritage</div>
        <div class="chip" data-chip="adventure">Adventure</div>
      </div>

      <div class="miniCard">
        <b style="font-size:13px;">Start location</b>
        <p>GPS start or manual start. Route updates automatically.</p>

        <div class="field" style="margin-top:10px;">
          <label>Start (manual)</label>
          <input id="startInput" placeholder="e.g., Shimla, HP"/>
        </div>

        <div class="toggleRow">
          <label style="margin:0;">Return to Start</label>
          <input id="loopToggle" type="checkbox"/>
        </div>

        <button class="btn" id="gpsBtn">Use Current Location (GPS)</button>
      </div>

      <div class="miniCard">
        <b style="font-size:13px;">Auto route</b>
        <p>Auto-optimize route order with Google.</p>

        <div class="toggleRow" style="margin-top:10px;">
          <label style="margin:0;">Auto optimize</label>
          <input id="autoOpt" type="checkbox" checked/>
        </div>

        <div class="field" style="margin-top:10px;">
          <label>Travel cost rate (₹/km)</label>
          <input id="ratePerKm" type="number" value="12" min="0"/>
        </div>
      </div>

      <div class="miniCard">
        <b style="font-size:13px;">Trip Budget</b>
        <p>Distance updates travel cost automatically.</p>

        <div class="panelTitle" style="margin-top:12px;">Expense Calculator</div>
        <div class="row2">
          <div class="field" style="margin:0;">
            <label>Days</label><input id="days" type="number" value="3" min="1"/>
          </div>
          <div class="field" style="margin:0;">
            <label>People</label><input id="people" type="number" value="2" min="1"/>
          </div>
        </div>
        <div class="row2">
          <div class="field" style="margin:0;">
            <label>Stay/day (₹)</label><input id="stay" type="number" value="1800" min="0"/>
          </div>
          <div class="field" style="margin:0;">
            <label>Food/day (₹)</label><input id="food" type="number" value="700" min="0"/>
          </div>
        </div>
        <div class="field" style="margin:0;">
          <label>Travel total (₹)</label><input id="travel" type="number" value="0" min="0"/>
        </div>
        <button class="btn" id="calcBtn">Calculate Total</button>
        <p id="calcOut" style="margin-top:8px; font-weight:750;">Total: ₹ —</p>
      </div>

      <div class="hint" id="firebaseStatus">Firebase: loading…</div>
      <div class="hint" id="debugOut">Debug: —</div>

      <div class="hint">
        <b>Data Path:</b> Your data is at DB root (keys like <i>akhand-chandi</i>, <i>annandale</i>…)
        <div class="pillMini"><span class="dot"></span> / (root)</div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <section class="hero">
        <div class="heroTop">
          <div>
            <h2>Places (Firebase) + Route Planner</h2>
            <p>Tap any card to open details page. Use <b>+ Add</b> to build route (needs coordinates).</p>
          </div>
          <button class="ghost" id="resetBtn">Reset</button>
        </div>

        <div class="searchBar">
          <input id="qMain" placeholder="Search places..." />
        </div>
      </section>

      <section class="split">
        <!-- Left -->
        <div class="leftPane">
          <div class="paneHead">
            <strong>Places</strong>
            <small id="countOut">0 results</small>
          </div>
          <div class="paneBody">
            <div class="grid" id="grid"></div>
          </div>
        </div>

        <!-- Right -->
        <div class="rightPane">
          <div class="paneHead">
            <strong>Route Planner</strong>
            <small id="routeStatus">Waiting for Maps…</small>
          </div>
          <div class="paneBody">
            <div class="routeStats">
              <div class="stat"><b id="stopsOut">0</b><span>Stops</span></div>
              <div class="stat"><b id="distanceOut">—</b><span>Distance</span></div>
              <div class="stat"><b id="durationOut">—</b><span>Duration</span></div>
              <div class="stat"><b id="totalOut">₹ —</b><span>Total trip est.</span></div>
            </div>

            <div id="map">Google Maps loading…</div>

            <div class="routeList" id="routeList"></div>

            <div class="itinerary" id="itinerary">
              <h4>Day-wise Itinerary</h4>
              <div class="day"><b>Day 1</b><p>Add stops to auto-fill itinerary.</p></div>
            </div>

            <button class="btn" id="clearRouteBtn" style="margin-top:12px;">Clear Route</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

    const GOOGLE_MAPS_API_KEY = "AIzaSyAKaFrj7JobWLloNQqzvx3SSibyrsiwzug";
    const FIREBASE_LOCATIONS_PATH = "/";

    const firebaseConfig = {
      apiKey: "AIzaSyAKaFrj7JobWLloNQqzvx3SSibyrsiwzug",
      authDomain: "revnue-records.firebaseapp.com",
      databaseURL: "https://revnue-records-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "revnue-records",
      storageBucket: "revnue-records.appspot.com",
      messagingSenderId: "182348503564",
      appId: "1:182348503564:web:480085405b09177245ad"
    };

    const grid = document.getElementById("grid");
    const countOut = document.getElementById("countOut");
    const nav = document.getElementById("nav");
    const districtSel = document.getElementById("district");
    const qSide = document.getElementById("q");
    const qMain = document.getElementById("qMain");
    const chipsSide = document.getElementById("chipsSide");
    const firebaseStatus = document.getElementById("firebaseStatus");
    const debugOut = document.getElementById("debugOut");

    const routeListEl = document.getElementById("routeList");
    const routeStatus = document.getElementById("routeStatus");
    const stopsOut = document.getElementById("stopsOut");
    const distanceOut = document.getElementById("distanceOut");
    const durationOut = document.getElementById("durationOut");
    const totalOut = document.getElementById("totalOut");
    const itineraryEl = document.getElementById("itinerary");

    const startInput = document.getElemen