<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Petroni Store ‚Äî Online Shop</title>
<meta name="theme-color" content="#070a16"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#050816; --panel:#0b1222; --card:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.12); --text:#eaf0ff; --muted:rgba(234,240,255,.70);
  --a1:#60a5fa; --a2:#22d3ee; --good:#34d399; --warn:#fbbf24; --bad:#fb7185;
  --r:22px; --shadow:0 26px 90px rgba(0,0,0,.50);
}
*{box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  margin:0; font-family:"Plus Jakarta Sans",system-ui;
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(96,165,250,.20), transparent 55%),
    radial-gradient(1000px 700px at 85% 10%, rgba(34,211,238,.14), transparent 55%),
    linear-gradient(180deg, #040612 0%, #070a16 45%, #040612 100%);
  overflow-x:hidden;
}
header{
  position:sticky;top:0;z-index:50;
  backdrop-filter: blur(14px);
  background: rgba(6,10,22,.65);
  border-bottom:1px solid rgba(255,255,255,.08);
}
.bar{
  max-width:1200px;margin:0 auto;
  padding:12px 16px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;
}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--text);font-weight:1000}
.mark{width:40px;height:40px;border-radius:14px;background:linear-gradient(135deg, rgba(96,165,250,.95), rgba(34,211,238,.9));box-shadow:0 18px 60px rgba(96,165,250,.22);}
.search{
  flex:1; min-width:210px;
  display:flex; gap:8px; align-items:center;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.05);
  padding:10px 12px; border-radius:16px;
}
.search input{flex:1;border:none;outline:none;background:transparent;color:var(--text);font-weight:900}
.btn{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:var(--text);
  font-weight:1000;
  padding:10px 12px;
  border-radius:14px;
  cursor:pointer;
  transition:.18s ease;
  display:inline-flex;align-items:center;gap:8px;
}
.btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.085);}
.btn.primary{border-color:rgba(96,165,250,.35); background:linear-gradient(135deg, rgba(96,165,250,.25), rgba(34,211,238,.15));}

.wrap{max-width:1200px;margin:0 auto;padding:14px 16px 0;}
.hero{
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06);
  border-radius:var(--r);
  box-shadow:var(--shadow);
  padding:16px;
}
.tag{display:inline-flex;gap:8px;align-items:center;font-size:12px;font-weight:1100;padding:8px 10px;border-radius:999px;border:1px solid rgba(96,165,250,.35);background:rgba(96,165,250,.12);}
.dot{width:9px;height:9px;border-radius:99px;background:linear-gradient(135deg,var(--a1),var(--a2));}
h1{margin:10px 0 6px;font-size:clamp(24px,4vw,40px);line-height:1.05;letter-spacing:-.6px}
.grad{background:linear-gradient(90deg,var(--a1),var(--a2));-webkit-background-clip:text;background-clip:text;color:transparent;}
.sub{margin:0;color:var(--muted);font-weight:900;line-height:1.6;max-width:80ch}
.tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin:12px 0 10px;}
.chips{display:flex;gap:8px;flex-wrap:wrap}
.chip{
  padding:8px 10px;border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04);
  color:var(--muted);
  font-weight:1000;
  font-size:12px;
  cursor:pointer;
  user-select:none;
  transition:.18s ease;
}
.chip.on{background:rgba(34,211,238,.12);border-color:rgba(34,211,238,.26);color:var(--text);}
.select{
  padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04);color:var(--text);font-weight:1100;outline:none;
}

.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;}
@media(max-width:1100px){.grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:820px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:520px){.grid{grid-template-columns:1fr}}

.p{
  border-radius:22px;border:1px solid rgba(255,255,255,.11);
  background:rgba(255,255,255,.05);
  padding:14px;display:flex;flex-direction:column;gap:10px;
  transition:.18s ease;
}
.p:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.07);}
.img{
  height:130px;border-radius:18px;border:1px solid rgba(255,255,255,.10);
  background:
    radial-gradient(180px 120px at 30% 30%, rgba(255,255,255,.18), transparent 55%),
    linear-gradient(135deg, rgba(96,165,250,.25), rgba(34,211,238,.16));
  display:grid;place-items:center;overflow:hidden;
}
.img img{width:100%;height:100%;object-fit:cover;display:block}
.name{font-weight:1200}
.desc{color:var(--muted);font-weight:900;font-size:12px;line-height:1.45;margin-top:-6px}
.meta{display:flex;gap:6px;flex-wrap:wrap}
.pill{
  font-size:11px;font-weight:1100;padding:6px 8px;border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04);color:var(--muted);
}
.pill.good{border-color:rgba(52,211,153,.22);background:rgba(52,211,153,.10);color:rgba(234,240,255,.92);}
.price{display:flex;justify-content:space-between;align-items:flex-end;gap:10px}
.price strong{font-weight:1200}
.price small{display:block;color:var(--muted);font-weight:1000;margin-top:2px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

.backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.55);
  backdrop-filter: blur(6px);
  opacity:0;pointer-events:none;transition:.2s ease;z-index:80;
}
.backdrop.show{opacity:1;pointer-events:auto;}
.drawer{
  position:fixed;right:0;top:0;width:min(420px,92vw);height:100vh;
  background:rgba(8,12,26,.88);border-left:1px solid rgba(255,255,255,.10);
  box-shadow:-24px 0 80px rgba(0,0,0,.55);
  transform:translateX(102%);transition:.26s ease;z-index:90;
  display:flex;flex-direction:column;
}
.drawer.show{transform:translateX(0);}
.dHead{padding:14px;display:flex;justify-content:space-between;align-items:center;gap:10px;border-bottom:1px solid rgba(255,255,255,.08);}
.dBody{padding:12px 14px;overflow:auto;flex:1;}
.dFoot{padding:12px 14px;border-top:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);}
.item{display:flex;gap:10px;padding:12px;border-radius:18px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);margin-bottom:10px;}
.thumb{width:46px;height:46px;border-radius:16px;display:grid;place-items:center;font-size:22px;border:1px solid rgba(255,255,255,.10);background:linear-gradient(135deg, rgba(96,165,250,.28), rgba(34,211,238,.16));overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover}
.line{display:flex;justify-content:space-between;gap:10px;font-weight:1200}
.line span{color:var(--muted);font-weight:1100}
.note{margin-top:10px;padding:12px;border-radius:18px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);color:var(--muted);font-weight:900;font-size:12px;line-height:1.55}
footer{padding:34px 16px;color:var(--muted);font-weight:900;border-top:1px solid rgba(255,255,255,.08);margin-top:28px;}
</style>
</head>
<body>

<header>
  <div class="bar">
    <a class="logo" href="#">
      <div class="mark"></div>
      <div>
        <div style="font-size:14px;">Petroni Store</div>
        <div style="font-size:12px;color:var(--muted);font-weight:900;" id="liveLine">Loading from Firebase‚Ä¶</div>
      </div>
    </a>

    <div class="search">
      üîé <input id="q" placeholder="Search products..." />
    </div>

    <button class="btn" id="modeBtn">Retail</button>
    <button class="btn primary" id="cartBtn">Cart ‚Ä¢ <span id="cc">0</span></button>
  </div>
</header>

<div class="wrap">
  <div class="hero">
    <div class="tag"><span class="dot"></span> Live products from Firebase ‚Ä¢ Category-wise shop</div>
    <h1>Online Shop with <span class="grad">Category Filters</span> and <span class="grad">Live Products</span></h1>
    <p class="sub">Admin console se product add/update karo ‚Äî yahan instantly reflect hoga. Retail / Wholesale toggle supported.</p>
  </div>

  <div class="tools" style="margin-top:14px;">
    <div class="chips" id="chips"></div>
    <select class="select" id="sort">
      <option value="featured">Sort: Featured</option>
      <option value="low">Price: Low ‚Üí High</option>
      <option value="high">Price: High ‚Üí Low</option>
      <option value="name">Name: A ‚Üí Z</option>
    </select>
  </div>

  <div class="grid" id="grid"></div>
</div>

<footer>¬© <span id="yr"></span> Petroni Store ‚Ä¢ Payments can be added via secure backend (Razorpay).</footer>

<div class="backdrop" id="bd"></div>
<aside class="drawer" id="dr">
  <div class="dHead">
    <div style="font-weight:1200;">üõí Cart</div>
    <div class="row">
      <button class="btn" id="clear">Clear</button>
      <button class="btn" id="close">Close</button>
    </div>
  </div>
  <div class="dBody" id="cb"></div>
  <div class="dFoot">
    <div class="line"><span>Subtotal</span><div id="sub">‚Çπ0</div></div>
    <div class="line" style="margin-top:6px;"><span>GST (demo)</span><div id="gst">‚Çπ0</div></div>
    <div class="line" style="margin-top:8px;font-size:16px;"><span>Total</span><div id="tot">‚Çπ0</div></div>
    <button class="btn primary" style="width:100%;margin-top:12px;" id="checkout">Checkout</button>
    <div class="note" id="rulesNote"></div>
  </div>
</aside>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>

<script>
  // ‚úÖ PASTE SAME CONFIG AS ADMIN HERE
  const firebaseConfig = {
    // apiKey: "",
    // authDomain: "",
    // databaseURL: "https://garg-enterprise-default-rtdb.asia-southeast1.firebasedatabase.app",
    // projectId: "",
    // storageBucket: "",
    // messagingSenderId: "",
    // appId: ""
  };

  const $ = id => document.getElementById(id);
  const money = n => "‚Çπ" + Math.round(n).toLocaleString("en-IN");
  const toNum = v => Number(v||0);

  // Local store state
  let state = JSON.parse(localStorage.getItem("petroni_store_state")||"null") || {
    wholesale:false, cat:"All", q:"", sort:"featured", cart:{}
  };
  const save = ()=> localStorage.setItem("petroni_store_state", JSON.stringify(state));

  // Live products from DB
  let LIVE = {}; // {id: product}
  let LIST = []; // array with id included
  let CATS = [];

  function finalPrice(p, qty){
    // retail uses finalPrice field directly
    if(!state.wholesale) return toNum(p.finalPrice ?? p.price ?? 0);

    // wholesale uses slabs based on qty if enabled
    if(!p.wholesaleEnabled) return toNum(p.finalPrice ?? p.price ?? 0);
    const slabs = Array.isArray(p.slabs) ? p.slabs : [];
    if(slabs.length===0) return toNum(p.finalPrice ?? p.price ?? 0);

    let price = slabs[0].price;
    for(const s of slabs) if(qty >= s.min) price = s.price;
    return toNum(price||0);
  }

  function cartCount(){ return Object.values(state.cart).reduce((a,b)=>a+b,0); }
  function cartLines(){
    return Object.entries(state.cart).map(([id,qty])=>{
      const p = LIVE[id];
      const up = finalPrice(p, qty);
      return {id, p, qty, up, line: up*qty};
    }).filter(x=>x.p);
  }
  function subtotal(){ return cartLines().reduce((s,l)=>s+l.line,0); }
  function gst(){ return subtotal()*0.18; }

  function validateWholesale(){
    if(!state.wholesale) return {ok:true, issues:[]};
    const issues=[];
    for(const [id,qty] of Object.entries(state.cart)){
      const p = LIVE[id]; if(!p) continue;
      const moq = toNum(p.moq||1);
      const pack = toNum(p.packSize||1);
      if(p.wholesaleEnabled){
        if(qty < moq) issues.push(`${p.name}: MOQ ${moq}`);
        if(pack>1 && qty%pack!==0) issues.push(`${p.name}: pack ${pack} multiple`);
      }
    }
    return {ok: issues.length===0, issues};
  }

  function renderChips(){
    const el = $("chips");
    const cats = ["All", ...CATS];
    el.innerHTML = cats.map(c=>`<div class="chip ${state.cat===c?"on":""}" data-c="${c}">${c}</div>`).join("");
    [...el.querySelectorAll(".chip")].forEach(ch=>{
      ch.onclick=()=>{ state.cat=ch.dataset.c; save(); render(); };
    });
  }

  function filtered(){
    let arr=[...LIST];
    if(state.cat!=="All") arr=arr.filter(x=>(x.category||"")===state.cat);
    const q=(state.q||"").trim().toLowerCase();
    if(q) arr=arr.filter(x=>((x.id+" "+x.name+" "+x.category+" "+(x.brand||"")).toLowerCase().includes(q)));

    if(state.sort==="low") arr.sort((a,b)=>(a.finalPrice||a.price||0)-(b.finalPrice||b.price||0));
    if(state.sort==="high") arr.sort((a,b)=>(b.finalPrice||b.price||0)-(a.finalPrice||a.price||0));
    if(state.sort==="name") arr.sort((a,b)=>(a.name||"").localeCompare(b.name||""));
    return arr;
  }

  function render(){
    $("modeBtn").textContent = state.wholesale ? "Wholesale" : "Retail";
    $("cc").textContent = cartCount();

    const g = $("grid");
    const arr = filtered();

    g.innerHTML = arr.map(p=>{
      const inCart = state.cart[p.id]||0;
      const qtyForPricing = Math.max(1, inCart||1);
      const up = finalPrice(p, qtyForPricing);
      const img = (p.images && p.images[0]) ? `<img src="${p.images[0]}" alt="">` : `<div style="font-size:34px;">üì¶</div>`;
      const stock = toNum(p.stock||0);
      const active = p.active !== false;

      const topSpecs = (p.specs||[]).slice(0,3).join(" ‚Ä¢ ");
      const moq = toNum(p.moq||1), pack = toNum(p.packSize||1);

      return `
      <div class="p">
        <div class="img">${img}</div>
        <div class="name">${p.name||p.id}</div>
        <div class="desc">${topSpecs || (p.brand?("Brand: "+p.brand):"")}</div>
        <div class="meta">
          <span class="pill">${p.category||"General"}</span>
          <span class="pill ${stock>0?"good":""}">${stock>0?("In stock: "+stock):"Out of stock"}</span>
          ${state.wholesale && p.wholesaleEnabled ? `<span class="pill">MOQ ${moq} ‚Ä¢ pack ${pack}</span>` : ``}
          ${active ? `` : `<span class="pill" style="border-color:rgba(251,113,133,.25);background:rgba(251,113,133,.10);color:#fff;">Hidden</span>`}
        </div>
        <div class="price">
          <div>
            <strong>${money(up)}</strong>
            <small>${state.wholesale ? "Wholesale (auto slabs)" : "Retail (finalPrice)"}</small>
          </div>
          <button class="btn primary" ${(!active || stock<=0)?"disabled style='opacity:.45;cursor:not-allowed'":""} data-add="${p.id}">Add</button>
        </div>
      </div>`;
    }).join("");

    // Add handlers
    [...g.querySelectorAll("[data-add]")].forEach(b=>{
      b.onclick=()=>{
        const id=b.dataset.add;
        const p=LIVE[id];
        if(!p || p.active===false) return;
        if(toNum(p.stock||0)<=0) return;
        state.cart[id]=(state.cart[id]||0)+1;
        save(); render(); renderCart();
      };
    });

    renderCart();
  }

  // CART drawer
  const bd=$("bd"), dr=$("dr");
  function openCart(){ bd.classList.add("show"); dr.classList.add("show"); renderCart(); }
  function closeCart(){ dr.classList.remove("show"); bd.classList.remove("show"); }
  $("cartBtn").onclick=openCart;
  $("close").onclick=closeCart;
  bd.onclick=closeCart;

  $("clear").onclick=()=>{ state.cart={}; save(); render(); renderCart(); };

  function renderCart(){
    const cb=$("cb");
    const L=cartLines();
    if(L.length===0){
      cb.innerHTML=`<div class="note">Cart is empty.</div>`;
    }else{
      cb.innerHTML=L.map(({id,p,qty,up,line})=>{
        const img = (p.images && p.images[0]) ? `<img src="${p.images[0]}" alt="">` : `üì¶`;
        return `
          <div class="item">
            <div class="thumb">${img}</div>
            <div style="flex:1;">
              <div style="font-weight:1200;">${p.name||id}</div>
              <div class="note" style="margin-top:8px;">
                Unit: ${money(up)} ‚Ä¢ Qty: ${qty} ‚Ä¢ Line: ${money(line)}
                ${state.wholesale && p.wholesaleEnabled ? `<br>MOQ ${p.moq||1}, pack ${p.packSize||1}` : ``}
              </div>
              <div class="row" style="margin-top:10px;">
                <button class="btn" data-dec="${id}">‚àí</button>
                <button class="btn" data-inc="${id}">+</button>
                <button class="btn" data-rm="${id}" style="border-color:rgba(251,113,133,.35);">Remove</button>
              </div>
            </div>
          </div>`;
      }).join("");

      cb.querySelectorAll("[data-dec]").forEach(b=>b.onclick=()=>{
        const id=b.dataset.dec;
        state.cart[id]=Math.max(1,(state.cart[id]||1)-1);
        save(); render(); renderCart();
      });
      cb.querySelectorAll("[data-inc]").forEach(b=>b.onclick=()=>{
        const id=b.dataset.inc;
        state.cart[id]=(state.cart[id]||0)+1;
        save(); render(); renderCart();
      });
      cb.querySelectorAll("[data-rm]").forEach(b=>b.onclick=()=>{
        const id=b.dataset.rm;
        delete state.cart[id];
        save(); render(); renderCart();
      });
    }

    const sub=subtotal(), g=gst(), t=sub+g;
    $("sub").textContent=money(sub);
    $("gst").textContent=money(g);
    $("tot").textContent=money(t);

    const v=validateWholesale();
    if(state.wholesale){
      $("rulesNote").innerHTML = v.ok
        ? `<b style="color:var(--text)">Wholesale rules OK ‚úÖ</b><div style="margin-top:6px;">Proceed to checkout.</div>`
        : `<b style="color:var(--text)">Fix required ‚ö†Ô∏è</b><div style="margin-top:6px;">‚Ä¢ ${v.issues.join("<br>‚Ä¢ ")}</div>`;
    }else{
      $("rulesNote").textContent="Retail checkout ready ‚úÖ";
    }
  }

  $("checkout").onclick=()=>{
    if(cartCount()===0) return alert("Cart empty");
    const v=validateWholesale();
    if(state.wholesale && !v.ok) return alert("Fix MOQ / pack rules first.");
    alert("Checkout ready. Next step: connect Razorpay secure backend.");
  };

  // UI bindings
  $("yr").textContent=new Date().getFullYear();
  $("q").value=state.q||"";
  $("q").oninput=()=>{ state.q=$("q").value; save(); render(); };
  $("sort").value=state.sort||"featured";
  $("sort").onchange=()=>{ state.sort=$("sort").value; save(); render(); };
  $("modeBtn").onclick=()=>{ state.wholesale=!state.wholesale; save(); render(); };

  // Firebase init + fetch
  try{
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    db.ref("products").on("value", (snap)=>{
      const raw = snap.val() || {};
      // only active products should show; but still allow hidden in DB
      LIVE = raw;
      LIST = Object.entries(raw).map(([id,p])=>({id, ...(p||{})}))
        .filter(p=>p && p.active !== false); // hide inactive from store
      // build categories
      const set = new Set();
      LIST.forEach(p=> set.add(p.category || "General"));
      CATS = [...set].sort();
      $("liveLine").textContent = `Live ‚Ä¢ ${LIST.length} products`;
      renderChips();
      render();
    });
  }catch(e){
    $("liveLine").textContent = "Firebase config missing";
    console.error(e);
  }
</script>

</body>
</html>
