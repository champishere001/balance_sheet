<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
  <title>Himachal Explorer — The Portal</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1220;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.16);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --accent:#7C5CFF;
      --accent2:#2AE7A6;
      --danger:#FF5C7A;
      --radius: 18px;
      --shadow: 0 18px 45px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(900px 400px at 80% 10%, rgba(42,231,166,.18), transparent 60%),
        radial-gradient(900px 400px at 10% 0%, rgba(124,92,255,.18), transparent 55%),
        linear-gradient(180deg, #060811 0%, #070A12 100%);
      overflow-x:hidden;
    }

    /* Header */
    .topbar{
      position:sticky; top:0; z-index:50;
      padding:14px 14px 10px;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(7,10,18,.78), rgba(7,10,18,.35));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .topbar-inner{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      max-width: 1380px; margin:0 auto;
    }
    .brand{
      display:flex; gap:12px; align-items:center; min-width:260px;
    }
    .logo{
      width:44px; height:44px; border-radius:12px;
      background: radial-gradient(circle at 30% 30%, rgba(124,92,255,.9), rgba(42,231,166,.55));
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
    }
    .brand h1{
      font-size:14px; letter-spacing:.22em; margin:0; font-weight:700;
    }
    .brand p{
      margin:3px 0 0; font-size:12px; color:var(--muted);
    }

    .quote{
      flex:1;
      display:flex; align-items:center; gap:12px;
      padding:10px 14px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
      min-height:46px;
      overflow:hidden;
    }
    .orb{
      width:26px; height:26px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.9), rgba(124,92,255,.8));
      box-shadow: 0 0 0 8px rgba(124,92,255,.10);
      flex:0 0 auto;
    }
    .quote span{color:rgba(255,255,255,.86); font-size:13px}
    .actions{display:flex; gap:10px; align-items:center}
    .btn{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:10px 14px;
      border-radius:999px;
      font-weight:650;
      letter-spacing:.06em;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      transition:.15s ease;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
    }
    .btn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.20)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(124,92,255,.92), rgba(42,231,166,.30));
      border-color: rgba(255,255,255,.18);
    }
    .btn.danger{
      background: rgba(255,92,122,.14);
      border-color: rgba(255,92,122,.35);
    }

    /* Layout */
    .wrap{max-width: 1380px; margin: 12px auto 26px; padding: 0 14px;}
    .grid{
      display:grid;
      grid-template-columns: 1.55fr 1fr 1.15fr;
      gap:14px;
      align-items:stretch;
    }
    .card{
      border-radius: var(--radius);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: 520px;
    }
    .card-head{
      padding:14px 14px 10px;
      display:flex; align-items:flex-start; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    }
    .card-head h2{
      margin:0;
      font-size:14px;
      letter-spacing:.14em;
      text-transform:uppercase;
    }
    .card-head small{display:block; color:var(--muted); margin-top:4px; letter-spacing:.06em}
    .card-body{padding:14px}

    /* LEFT: Package Finder bg image (NO BLUR!) */
    .finder-bg{
      position:relative;
      border-radius: 14px;
      height: 330px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background-image: url("assets/package-bg.jpg"); /* <-- change if needed */
      background-size: cover;
      background-position: center;
      background-repeat:no-repeat;
      filter: none !important; /* ✅ no blur */
    }
    .finder-overlay{
      position:absolute; inset:0;
      background: linear-gradient(180deg,
        rgba(0,0,0,.12) 0%,
        rgba(0,0,0,.08) 40%,
        rgba(0,0,0,.42) 100%);
      pointer-events:none;
    }

    label{display:block; font-size:11px; letter-spacing:.14em; color:rgba(255,255,255,.70); margin:10px 0 6px; text-transform:uppercase;}
    input,select{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.28);
      color: var(--text);
      outline:none;
      font-size:14px;
    }
    input::placeholder{color: rgba(255,255,255,.40)}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
    .form-actions{display:flex; gap:10px; margin-top:12px; justify-content:flex-end;}

    /* Middle map */
    #map{
      width:100%;
      height: 330px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .map-actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    .pill{
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      cursor:pointer;
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: rgba(255,255,255,.84);
      user-select:none;
    }

    /* RIGHT */
    .profile{
      display:flex; gap:12px; align-items:center;
      padding:14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
    }
    .avatar{
      width:44px;height:44px;border-radius:14px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.8), rgba(124,92,255,.85));
      border:1px solid rgba(255,255,255,.16);
      flex:0 0 auto;
    }
    .profile h3{margin:0;font-size:14px;letter-spacing:.12em}
    .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .chip{
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      cursor:pointer;
    }
    .motto{
      margin:10px 0 0;
      color: rgba(255,255,255,.70);
      font-size:12px;
      line-height:1.5;
      border-top:1px solid rgba(255,255,255,.08);
      padding-top:10px;
    }

    .box{
      margin-top:12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    .box-head{padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.08);}
    .box-head h4{margin:0; font-size:12px; letter-spacing:.18em; text-transform:uppercase;}
    .box-head small{color:var(--muted); letter-spacing:.08em}

    /* ✅ Scroll fix for details */
    #itineraryScroll{
      height: 290px;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      padding: 12px 14px 14px;
    }

    .kv{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
      padding:12px 14px;
      border-top:1px solid rgba(255,255,255,.08);
    }
    .kv .k{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      border-radius: 14px;
      padding:12px;
      min-height:56px;
    }
    .kv .k span{display:block; font-size:11px; color:var(--muted); letter-spacing:.14em; text-transform:uppercase}
    .kv .k b{display:block; margin-top:6px; font-size:15px}

    .day{
      padding:12px;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      margin-bottom:10px;
    }
    .day h5{
      margin:0 0 6px;
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
    }
    .day ul{margin:0; padding-left:18px; color:rgba(255,255,255,.82)}
    .day li{margin:6px 0}

    .footer-strip{
      margin-top:14px;
      padding:12px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(135deg, rgba(124,92,255,.14), rgba(42,231,166,.10));
      color: rgba(255,255,255,.86);
      font-size:12px;
      letter-spacing:.06em;
    }

    @media (max-width: 1100px){
      .grid{grid-template-columns: 1fr;}
      .card{min-height:auto}
      #itineraryScroll{height: 240px;}
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>HIMACHAL EXPLORER PORTAL</h1>
          <p id="loadedCounts">Loaded — templates • — places</p>
        </div>
      </div>

      <div class="quote">
        <div class="orb"></div>
        <span id="quoteText">“Let your route be scenic, your pace be human.”</span>
      </div>

      <div class="actions">
        <button class="btn primary" id="fitBtn">FIT ROUTE</button>
        <button class="btn danger" id="clearBtn">CLEAR</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">

      <!-- LEFT -->
      <section class="card">
        <div class="card-head">
          <div>
            <h2>Package Finder</h2>
            <small>End derived from route_path (Column G)</small>
          </div>
          <div style="color:rgba(255,255,255,.55)">—</div>
        </div>

        <div class="card-body">
          <div class="finder-bg" aria-label="Package background image">
            <div class="finder-overlay"></div>
          </div>

          <div>
            <label for="startInput">Start (Templates)</label>
            <input id="startInput" list="startList" placeholder="E.g. AMRITSAR / DELHI / CHANDIGARH"/>
            <datalist id="startList"></datalist>
          </div>

          <div class="row">
            <div>
              <label for="daysInput">Days (Optional)</label>
              <input id="daysInput" type="number" min="1" max="20" placeholder="ANY"/>
            </div>
            <div>
              <label for="paxInput">Pax</label>
              <input id="paxInput" type="number" min="1" max="40" value="2"/>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn" id="resetBtn">RESET</button>
            <button class="btn primary" id="generateBtn">GENERATE</button>
          </div>
        </div>
      </section>

      <!-- MIDDLE -->
      <section class="card">
        <div class="card-head">
          <div>
            <h2>Live Route Map</h2>
            <small>OSRM road polyline + markers</small>
          </div>
          <div style="color:rgba(255,255,255,.55)">—</div>
        </div>
        <div class="card-body">
          <div id="map"></div>

          <div class="map-actions">
            <div class="pill" id="showStopsBtn">SHOW STOPS</div>
            <div class="pill" id="startEndOnlyBtn">START/END ONLY</div>
            <div class="pill" id="toggleTilesBtn">TOGGLE TILES</div>
          </div>
        </div>
      </section>

      <!-- RIGHT -->
      <section class="card" id="itineraryPanel">
        <div class="card-head">
          <div>
            <h2>Itinerary</h2>
            <small>Tap a place → popup details</small>
          </div>
          <div style="color:rgba(255,255,255,.55)">—</div>
        </div>

        <div class="card-body">
          <div class="profile">
            <div class="avatar"></div>
            <div style="flex:1">
              <h3>CHANDAN PANWAR</h3>
              <div class="chips">
                <div class="chip" id="callChip">CALL: +91 7018138847</div>
                <div class="chip" id="emailChip">EMAIL</div>
                <div class="chip" id="waChip">WHATSAPP</div>
                <div class="chip" id="copyChip">COPY DETAILS</div>
              </div>
              <p class="motto">“Creating Memorable Journeys for Visitors — Revenue Comes After Trust.”</p>
            </div>
          </div>

          <div class="box">
            <div class="box-head">
              <h4>Select a Package</h4>
              <small>Day-wise details will appear here</small>
            </div>

            <!-- ✅ Scrollable -->
            <div id="itineraryScroll">
              <div class="day">
                <h5>Ready</h5>
                <div style="color:rgba(255,255,255,.70)">Type Start & click <b>Generate</b>. Then select a package.</div>
              </div>

              <div class="day">
                <h5>Day 1</h5>
                <ul>
                  <li>Start → Scenic viewpoints</li>
                  <li>Local market walk</li>
                </ul>
              </div>
              <div class="day">
                <h5>Day 2</h5>
                <ul>
                  <li>Temple / heritage stops</li>
                  <li>Sunset point</li>
                </ul>
              </div>
            </div>

            <div class="kv">
              <div class="k">
                <span>Our Price (Est.)</span>
                <b id="priceTotal">—</b>
              </div>
              <div class="k">
                <span>Per Person</span>
                <b id="pricePer">—</b>
              </div>
            </div>

            <div class="kv" style="border-top:0">
              <div class="k" style="grid-column:1/-1">
                <span>Package Includes / Excludes</span>
                <b id="incExc">—</b>
              </div>
            </div>
          </div>

          <div class="footer-strip">
            End derived from route_path (Column G) • Start: Templates • Days optional • Pax • Reset • Generate
          </div>
        </div>
      </section>

    </div>
  </main>

  <script>
    /***************
     * Quotes rotate
     ***************/
    const quotes = [
      "“Let your route be scenic, your pace be human.”",
      "“Mountains don’t rush — neither should your travel.”",
      "“In Himachal, every turn becomes a memory.”",
      "“Choose fewer places, experience them deeper.”"
    ];
    let qi = 0;
    setInterval(()=> {
      qi = (qi+1) % quotes.length;
      document.getElementById("quoteText").textContent = quotes[qi];
    }, 5000);

    /***************
     * Map init
     ***************/
    const map = L.map('map', { zoomControl:true }).setView([31.1048, 77.1734], 7);
    let tilesOn = true;
    const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    let routeLine = null;
    let markers = [];

    function clearMap(){
      if(routeLine){ map.removeLayer(routeLine); routeLine = null; }
      markers.forEach(m => map.removeLayer(m));
      markers = [];
    }

    function fitRoute(){
      if(routeLine){
        map.fitBounds(routeLine.getBounds(), { padding:[30,30] });
      }
    }

    document.getElementById("fitBtn").onclick = fitRoute;
    document.getElementById("clearBtn").onclick = () => {
      clearMap();
      document.getElementById("itineraryScroll").scrollTop = 0;
      document.getElementById("priceTotal").textContent = "—";
      document.getElementById("pricePer").textContent = "—";
      document.getElementById("incExc").textContent = "—";
    };

    document.getElementById("toggleTilesBtn").onclick = () => {
      tilesOn = !tilesOn;
      if(tilesOn) tileLayer.addTo(map); else map.removeLayer(tileLayer);
    };

    setTimeout(()=>map.invalidateSize(), 500);

    /***************
     * Firebase (paste your config)
     ***************/
    const firebaseConfig = {
      // Paste your Firebase config here
    };

    let db = null;
    try{
      if(firebaseConfig && firebaseConfig.projectId){
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
      }
    }catch(e){
      console.warn("Firebase not initialized:", e);
    }

    /***************
     * Demo start list (replace with your DB)
     ***************/
    const demoStarts = ["CHANDIGARH", "DELHI", "AMRITSAR", "SHIMLA"];
    const startList = document.getElementById("startList");
    demoStarts.forEach(s=>{
      const opt = document.createElement("option");
      opt.value = s;
      startList.appendChild(opt);
    });
    document.getElementById("loadedCounts").textContent = "Loaded 132 templates • 238 places";

    /***************
     * Generate button (demo route)
     ***************/
    async function drawDemoRoute(){
      clearMap();

      const pts = [
        {name:"Chandigarh", lat:30.7333, lon:76.7794},
        {name:"Shimla", lat:31.1048, lon:77.1734},
        {name:"Manali", lat:32.2432, lon:77.1892}
      ];

      pts.forEach(p=>{
        const m = L.marker([p.lat, p.lon]).addTo(map).bindPopup(`<b>${p.name}</b>`);
        markers.push(m);
      });

      routeLine = L.polyline(pts.map(p=>[p.lat,p.lon]), { weight:5, opacity:.9 }).addTo(map);
      fitRoute();

      const it = document.getElementById("itineraryScroll");
      it.innerHTML = `
        <div class="day">
          <h5>Selected Package</h5>
          <div style="color:rgba(255,255,255,.70)">Demo: Chandigarh → Shimla → Manali</div>
        </div>
        <div class="day">
          <h5>Day 1</h5>
          <ul>
            <li>Chandigarh → Shimla (evening Mall Road)</li>
            <li>Sunset at Ridge</li>
          </ul>
        </div>
        <div class="day">
          <h5>Day 2</h5>
          <ul>
            <li>Shimla → Manali</li>
            <li>Hadimba / Old Manali</li>
          </ul>
        </div>
        <div class="day">
          <h5>Day 3</h5>
          <ul>
            <li>Solang Valley</li>
            <li>Return / extend</li>
          </ul>
        </div>
      `;
      it.scrollTop = 0;

      const pax = Math.max(1, parseInt(document.getElementById("paxInput").value || "2", 10));
      const total = 18000 + (pax * 1200);
      document.getElementById("priceTotal").textContent = "₹ " + total.toLocaleString("en-IN");
      document.getElementById("pricePer").textContent = "₹ " + Math.round(total/pax).toLocaleString("en-IN");
      document.getElementById("incExc").textContent = "Includes: Transport, Driver • Excludes: Entry tickets, Personal expenses";
    }

    document.getElementById("generateBtn").onclick = () => {
      const start = (document.getElementById("startInput").value || "").trim().toUpperCase();
      if(!start){
        alert("Start type karo (e.g. CHANDIGARH) then Generate.");
        return;
      }
      drawDemoRoute();
    };

    document.getElementById("resetBtn").onclick = () => {
      document.getElementById("startInput").value = "";
      document.getElementById("daysInput").value = "";
      document.getElementById("paxInput").value = 2;
      document.getElementById("itineraryScroll").scrollTop = 0;
    };

    /***************
     * Contact chips
     ***************/
    const phone = "+917018138847";
    const email = "chandanpanwar001@gmail.com";
    document.getElementById("callChip").onclick = () => window.location.href = "tel:" + phone;
    document.getElementById("waChip").onclick = () => window.open("https://wa.me/" + phone.replace("+",""), "_blank");
    document.getElementById("emailChip").onclick = () => window.location.href = "mailto:" + email;
    document.getElementById("copyChip").onclick = async () => {
      const text = `Chandan Panwar\nPhone: +91 7018138847\nEmail: ${email}\n“Creating Memorable Journeys for Visitors — Revenue Comes After Trust.”`;
      try{
        await navigator.clipboard.writeText(text);
        alert("Copied ✅");
      }catch(e){
        alert(text);
      }
    };
  </script>
</body>
</html>