<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Himachal Explorer — Packages + Map + Day-wise Itinerary</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1220;
      --stroke:rgba(255,255,255,.10);
      --muted:rgba(255,255,255,.65);
      --text:rgba(255,255,255,.92);
      --shadow: 0 24px 90px rgba(0,0,0,.55);
      --radius: 18px;
      --acc:#7C3AED;

      --topH: 92px;
      --gap: 14px;

      --leftPct: 36%;
      --mapPct: 24%;
      --rightPct: 40%;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(124,58,237,.18), transparent 60%),
        radial-gradient(900px 520px at 85% 10%, rgba(34,197,94,.14), transparent 60%),
        radial-gradient(900px 520px at 50% 90%, rgba(6,182,212,.12), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:auto;
    }

    .aurora{
      position:fixed; inset:-30%;
      background:
        radial-gradient(900px 500px at 25% 30%, rgba(124,58,237,.22), transparent 65%),
        radial-gradient(900px 520px at 75% 25%, rgba(34,197,94,.18), transparent 66%),
        radial-gradient(860px 540px at 55% 75%, rgba(6,182,212,.14), transparent 66%);
      filter: blur(45px);
      opacity:.9;
      animation: drift 14s ease-in-out infinite;
      pointer-events:none;
      z-index:-3;
    }
    @keyframes drift{
      0%,100%{ transform: translate3d(0,0,0) scale(1); }
      50%{ transform: translate3d(3%, -2%, 0) scale(1.06); }
    }
    .noise{
      position:fixed; inset:0; z-index:-2; pointer-events:none; opacity:.12; mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
    }

    .app{ min-height:100%; display:grid; grid-template-rows: var(--topH) 1fr; }

    .top{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 14px 12px;
      border-bottom: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      backdrop-filter: blur(14px);
      gap: 12px;
    }

    .brand{ display:flex; align-items:center; gap:12px; min-width: 260px; }
    .logo{
      width:54px; height:54px; border-radius:16px;
      background: rgba(255,255,255,.10);
      border:1px solid var(--stroke);
      display:grid; place-items:center;
      overflow:hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block; }
    .brand h1{ margin:0; font-size:14px; letter-spacing:.18em; text-transform:uppercase; }
    .brand p{ margin:4px 0 0; font-size:12px; color:var(--muted); line-height:1.25; }

    .actions{
      display:flex; gap:10px; align-items:center;
      min-width: 260px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .chip{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      border-radius: 999px;
      padding: 9px 12px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing:.08em;
      display:inline-flex; align-items:center; gap:10px;
      cursor:pointer;
      user-select:none;
      backdrop-filter: blur(12px);
      white-space: nowrap;
    }
    .chip:hover{ background: rgba(255,255,255,.08); color: rgba(255,255,255,.82); }

    .main{
      height: calc(100vh - var(--topH));
      display:grid;
      grid-template-columns: var(--leftPct) var(--mapPct) var(--rightPct);
      gap: var(--gap);
      padding: 14px;
      overflow: hidden;
    }

    .pane{
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;

      display:flex;
      flex-direction:column;

      height:100%;
      min-height:0;
    }

    .paneHdr{
      padding: 12px 12px 10px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex:0 0 auto;
    }
    .paneHdr .t{
      font-size:12px;
      letter-spacing:.18em;
      text-transform: uppercase;
      margin:0;
    }
    .paneHdr .s{
      font-size:11px;
      color:var(--muted);
      letter-spacing:.08em;
      text-transform: uppercase;
    }

    .filters{
      padding: 12px;
      border-bottom:1px solid var(--stroke);
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      flex:0 0 auto;
    }
    .field label{
      display:block;
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing:.12em;
      margin:0 0 6px 2px;
    }
    input, select{
      width:100%;
      padding: 11px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      outline:none;
    }
    input:focus, select:focus{
      border-color: rgba(124,58,237,.55);
      box-shadow: 0 0 0 3px rgba(124,58,237,.16);
    }

    /* ✅ BUTTON FIX (NO HUGE BUTTONS) */
    .btnRow{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .btn{
      flex:0 0 auto;
      padding: 11px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(6,182,212,.65));
      color:#fff;
      font-weight: 900;
      letter-spacing:.10em;
      text-transform: uppercase;
      cursor:pointer;

      width:auto;
      min-width: 130px;
      max-width: 190px;
      white-space: nowrap;
    }
    .btn.secondary{
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.85);
    }
    .btn:hover{ filter: brightness(1.05); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px); }
    @media (max-width: 520px){
      .btnRow{ flex-wrap:wrap; }
      .btn{ flex:1 1 0; max-width:unset; }
    }

    .metaPills{
      padding: 0 12px 12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--stroke);
      flex:0 0 auto;
    }
    .pill{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 11px;
      letter-spacing:.10em;
      text-transform: uppercase;
      color: rgba(255,255,255,.78);
      display:inline-flex; align-items:center; gap:8px;
    }
    .pill b{ color:#fff; letter-spacing:.06em; }

    .pkgLayout{
      flex:1;
      display:grid;
      grid-template-columns: 160px 1fr;
      min-height:0;
      overflow:hidden;
    }
    .districtBar{
      border-right:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      overflow:auto;
      padding:10px;
      min-height:0;
    }
    .distItem{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.86);
      border-radius: 14px;
      padding:10px 10px;
      font-size: 11px;
      letter-spacing:.10em;
      text-transform: uppercase;
      margin-bottom:10px;
      cursor:pointer;
      user-select:none;
    }
    .distItem:hover{ background: rgba(255,255,255,.08); }
    .distItem.active{
      border-color: rgba(124,58,237,.70);
      box-shadow: 0 0 0 3px rgba(124,58,237,.16);
      background: rgba(124,58,237,.12);
    }

    .pkgList{
      padding: 12px;
      overflow:auto;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      min-height:0;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
    }

    .pkgGroupHdr{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 10px;
    }
    .pkgGroupHdr .h1{
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.12em;
      text-transform: uppercase;
    }
    .pkgGroupHdr .h2{
      margin-top:6px;
      font-size: 11px;
      color: rgba(255,255,255,.75);
      letter-spacing:.08em;
      text-transform: uppercase;
      line-height: 1.35;
    }

    .pkg{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 10px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      display:flex; gap:10px;
      min-width:0;
    }
    .pkg:hover{ transform: translateY(-1px); border-color: rgba(124,58,237,.35); background: rgba(0,0,0,.28); }
    .pkg.active{ border-color: rgba(124,58,237,.70); box-shadow: 0 0 0 3px rgba(124,58,237,.18); }

    .pkgPic{
      width:58px; height:58px; border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.14), rgba(124,58,237,.18));
      overflow:hidden;
      flex:0 0 auto;
      display:grid; place-items:center;
      font-weight: 950;
      color: rgba(255,255,255,.85);
    }
    .pkgPic img{ width:100%; height:100%; object-fit:cover; display:block; }
    .pkgBody{ min-width:0; flex:1; }
    .pkgName{
      font-size: 12.5px;
      font-weight: 950;
      letter-spacing:.10em;
      text-transform: uppercase;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      margin-bottom: 6px;
    }
    .pkgMeta{
      font-size: 11px;
      color: rgba(255,255,255,.72);
      letter-spacing:.08em;
      text-transform: uppercase;
      line-height: 1.35;
    }
    .diffLine{
      margin-top:6px;
      font-size: 11px;
      color: rgba(255,255,255,.88);
      letter-spacing:.04em;
      text-transform:none;
      line-height:1.35;
      opacity:.98;
    }

    /* MAP */
    #map{
      width:100%;
      height:100%;
      min-height:0;
      background: rgba(255,255,255,.04);
    }
    .mapTools{
      padding: 10px 12px;
      border-top:1px solid var(--stroke);
      display:flex; gap:10px; flex-wrap:wrap;
      flex:0 0 auto;
    }
    .toolBtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.88);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 11px;
      letter-spacing:.12em;
      text-transform: uppercase;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:10px;
      user-select:none;
      white-space: nowrap;
      text-decoration:none;
    }
    .toolBtn:hover{ background: rgba(255,255,255,.08); }

    /* Right: itinerary list (day-wise) */
    .itWrap{
      padding: 12px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
      flex:1;
    }
    .heroCard{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 12px;
    }
    .bigTitle{
      margin:0;
      font-size: 13px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color:#fff;
    }
    .muted{ color: var(--muted); font-size: 11.5px; letter-spacing:.08em; text-transform: uppercase; line-height:1.35; }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .mini{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 10px;
    }
    .mini .k{ font-size: 10.5px; letter-spacing:.16em; text-transform: uppercase; color: rgba(255,255,255,.70); }
    .mini .v{ margin-top:6px; font-size: 14px; font-weight: 950; letter-spacing:.06em; color:#fff; }
    .mini .v small{ font-size: 11px; color: rgba(255,255,255,.72); font-weight: 800; }

    .daysList{ display:flex; flex-direction:column; gap:10px; }

    .dayCard{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 12px;
    }
    .dayTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom: 8px;
    }
    .dayTop .d{
      font-size: 12px; font-weight: 950; letter-spacing:.18em; text-transform: uppercase;
    }
    .dayTop .dateTag{
      font-size: 10.5px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: rgba(255,255,255,.72);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      padding:6px 8px;
      border-radius: 999px;
      white-space:nowrap;
    }

    .placeLine{
      display:flex; align-items:center; gap:10px;
      padding: 8px 10px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      border-radius: 14px;
      margin-top: 8px;
      cursor:pointer;
    }
    .placeLine:hover{ background: rgba(255,255,255,.08); }

    .thumb{
      width:40px; height:40px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.14), rgba(6,182,212,.18));
      flex:0 0 auto;
      display:grid; place-items:center;
      font-weight:950;
      color: rgba(255,255,255,.9);
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

    .pinfo{ min-width:0; flex:1; }
    .pname{
      font-size: 12px;
      font-weight: 950;
      letter-spacing:.10em;
      text-transform: uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .pmeta{
      margin-top:3px;
      font-size: 10.5px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: rgba(255,255,255,.68);
      white-space:nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    /* MODAL POPUP for place detail */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      z-index:99999;
      background: rgba(0,0,0,.58);
      backdrop-filter: blur(8px);
    }
    .modal.show{ display:flex; }

    .modalCard{
      width:min(860px, 100%);
      max-height: min(86vh, 860px);
      overflow:hidden;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,14,24,.92);
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .modalHdr{
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex:0 0 auto;
    }
    .modalHdr .ttl{
      font-size: 12px;
      letter-spacing:.18em;
      text-transform: uppercase;
      font-weight:950;
      margin:0;
    }
    .xbtn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:#fff;
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      letter-spacing:.12em;
      text-transform: uppercase;
      font-size:11px;
      font-weight:900;
    }
    .xbtn:hover{ background: rgba(255,255,255,.09); }

    .modalBody{
      padding:12px;
      overflow:auto;
      min-height:0;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:12px;
    }
    @media (max-width: 820px){
      .modalBody{ grid-template-columns:1fr; }
    }

    .placeHero{
      width:100%;
      height:200px;
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      position:relative;
    }
    .placeHero img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .galBtn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.45);
      color:#fff;
      border-radius: 12px;
      padding: 6px 10px;
      cursor:pointer;
      user-select:none;
    }
    .galBtn.left{ left:8px; }
    .galBtn.right{ right:8px; }

    .dots{
      display:flex;
      gap:6px;
      justify-content:center;
      margin-top:8px;
    }
    .dot{
      width:7px; height:7px;
      border-radius:50%;
      background: rgba(255,255,255,.35);
      cursor:pointer;
    }
    .dot.active{ background:#fff; }

    .detailCard{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 12px;
    }
    .detailCard h3{
      margin:0 0 10px;
      font-size:11.5px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color:#fff;
    }
    .detailCard p{
      margin:0;
      color: rgba(255,255,255,.78);
      line-height:1.55;
      font-size: 13px;
    }
    .bullets{
      margin:8px 0 0;
      padding:0 0 0 16px;
      color: rgba(255,255,255,.78);
      line-height:1.55;
      font-size: 13px;
    }

    .toast{
      position:fixed;
      left: 14px;
      bottom: 14px;
      z-index: 9999;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,14,24,.88);
      border-radius: 16px;
      padding: 10px 12px;
      color: rgba(255,255,255,.82);
      font-size: 11px;
      letter-spacing:.12em;
      text-transform: uppercase;
      box-shadow: 0 30px 90px rgba(0,0,0,.65);
      display:none;
      max-width: 560px;
    }
    .toast.show{ display:block; }

    @media (max-width: 1200px){
      .main{
        grid-template-columns: 1fr;
        grid-template-rows: auto 420px auto;
        height:auto;
        overflow:visible;
      }
      #map{ height: 420px; }
      .pkgLayout{ grid-template-columns: 1fr; }
      .districtBar{
        display:flex; gap:10px; flex-wrap:wrap;
        border-right:none;
        border-bottom:1px solid rgba(255,255,255,.10);
      }
      .distItem{ margin-bottom:0; }
      .actions{ min-width:unset; }
    }
  </style>
</head>

<body>
  <div class="aurora"></div>
  <div class="noise"></div>

  <div class="app">
    <!-- TOP BAR -->
    <div class="top">
      <div class="brand">
        <div class="logo">
          <img alt="Himachal Explorer" src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=200&q=70">
        </div>
        <div>
          <h1>Himachal Explorer</h1>
          <p>Packages • Map • Day-wise itinerary • Place details popup</p>
        </div>
      </div>

      <div class="actions">
        <div class="chip" id="chipHelp">How it works</div>
        <div class="chip" id="chipClear">Clear selection</div>
      </div>
    </div>

    <!-- MAIN GRID -->
    <div class="main">

      <!-- LEFT: PACKAGES -->
      <section class="pane" aria-label="Packages">
        <div class="paneHdr">
          <p class="t">Packages</p>
          <span class="s" id="pkgCount">0 packages</span>
        </div>

        <div class="filters">
          <div class="field">
            <label>Start Point</label>
            <select id="startPoint">
              <option value="Delhi">Delhi</option>
              <option value="Chandigarh">Chandigarh</option>
              <option value="Amritsar">Amritsar</option>
              <option value="Shimla">Shimla</option>
              <option value="Mandi">Mandi</option>
              <option value="Dharamshala">Dharamshala</option>
            </select>
          </div>

          <div class="field">
            <label>No. of Persons</label>
            <input id="persons" type="number" min="1" value="2"/>
          </div>

          <div class="field">
            <label>Trip Start Date</label>
            <input id="tripDate" type="date"/>
          </div>

          <div class="btnRow">
            <button class="btn secondary" id="resetBtn" type="button">Reset</button>
            <button class="btn" id="generateBtn" type="button">Generate</button>
          </div>
        </div>

        <div class="metaPills">
          <div class="pill">District <b id="pillDistrict">All</b></div>
          <div class="pill">Selected <b id="pillSelected">None</b></div>
        </div>

        <div class="pkgLayout">
          <div class="districtBar" id="districtBar"></div>
          <div class="pkgList" id="pkgList"></div>
        </div>
      </section>

      <!-- MIDDLE: MAP -->
      <section class="pane" aria-label="Map">
        <div class="paneHdr">
          <p class="t">Map</p>
          <span class="s" id="mapStatus">Ready</span>
        </div>
        <div id="map"></div>
        <div class="mapTools">
          <a class="toolBtn" href="#" id="zoomHimachal">Zoom Himachal</a>
          <a class="toolBtn" href="#" id="fitRoute">Fit Route</a>
        </div>
      </section>

      <!-- RIGHT: ITINERARY -->
      <section class="pane" aria-label="Itinerary">
        <div class="paneHdr">
          <p class="t">Itinerary</p>
          <span class="s" id="itiHint">Select a package</span>
        </div>

        <div class="itWrap" id="itWrap">
          <div class="heroCard">
            <h2 class="bigTitle" id="itiTitle">No package selected</h2>
            <div class="muted" id="itiSub">Choose a package from the left to see day-wise places (date-wise).</div>

            <div class="row2" style="margin-top:10px;">
              <div class="mini">
                <div class="k">Days</div>
                <div class="v" id="statDays">—</div>
              </div>
              <div class="mini">
                <div class="k">Places</div>
                <div class="v" id="statPlaces">—</div>
              </div>
            </div>
          </div>

          <div class="daysList" id="daysList"></div>
        </div>
      </section>

    </div>
  </div>

  <!-- PLACE DETAIL MODAL -->
  <div class="modal" id="placeModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHdr">
        <p class="ttl" id="modalTitle">Place</p>
        <button class="xbtn" id="modalClose" type="button">Close</button>
      </div>

      <div class="modalBody">
        <div>
          <div class="placeHero">
            <img id="modalImg" alt="Place image" src="">
            <button class="galBtn left" id="imgPrev" type="button">‹</button>
            <button class="galBtn right" id="imgNext" type="button">›</button>
          </div>
          <div class="dots" id="imgDots"></div>
        </div>

        <div style="display:flex; flex-direction:column; gap:12px; min-height:0;">
          <div class="detailCard">
            <h3>About</h3>
            <p id="modalAbout">—</p>
          </div>

          <div class="detailCard">
            <h3>What you can find</h3>
            <ul class="bullets" id="modalBullets"></ul>
          </div>

          <div class="detailCard">
            <h3>Meta</h3>
            <p id="modalMeta">—</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
/* =========================================================
   DEMO DATA (replace with your real packages/places)
   - Each package has day-wise itinerary: [{day, places:[placeId,...]}]
   - Each place has detail fields used in popup
========================================================= */

const PLACES = {
  "shimla-mall-road": {
    id: "shimla-mall-road",
    name: "Mall Road, Shimla",
    district: "SHIMLA",
    lat: 31.1048, lng: 77.1734,
    history: "Mall Road is the heart of Shimla, developed during the British era as the main promenade and commercial spine of the hill station.",
    whatYouFind: [
      "Cafes and bakeries",
      "Shopping street and local souvenirs",
      "Views of ridge area",
      "Evening walk and photography"
    ],
    images: [
      "https://images.unsplash.com/photo-1626795841154-0a7c4fa2f2b2?auto=format&fit=crop&w=1200&q=70",
      "https://images.unsplash.com/photo-1524492412937-4961d66aa114?auto=format&fit=crop&w=1200&q=70"
    ]
  },
  "kufri": {
    id: "kufri",
    name: "Kufri",
    district: "SHIMLA",
    lat: 31.0985, lng: 77.2666,
    history: "Kufri is a small hill station near Shimla, known for seasonal snow and scenic viewpoints.",
    whatYouFind: [
      "Viewpoints and pine forests",
      "Snow activities (seasonal)",
      "Short hikes and horse rides",
      "Family picnic spots"
    ],
    images: [
      "https://images.unsplash.com/photo-1518684079-3c830dcef090?auto=format&fit=crop&w=1200&q=70"
    ]
  },
  "manali-hidimba": {
    id: "manali-hidimba",
    name: "Hidimba Devi Temple, Manali",
    district: "KULLU",
    lat: 32.2432, lng: 77.1892,
    history: "A wooden temple set in cedar forest, dedicated to Hidimba Devi with distinct Himalayan architecture.",
    whatYouFind: [
      "Cedar forest atmosphere",
      "Temple architecture and carvings",
      "Calm walking paths",
      "Local stalls nearby"
    ],
    images: [
      "https://images.unsplash.com/photo-1548013146-72479768bada?auto=format&fit=crop&w=1200&q=70"
    ]
  },
  "solang": {
    id: "solang",
    name: "Solang Valley",
    district: "KULLU",
    lat: 32.3167, lng: 77.1556,
    history: "Solang Valley is popular for adventure activities and open mountain views near Manali.",
    whatYouFind: [
      "Paragliding (seasonal)",
      "Cable car / ropeway (where available)",
      "Snow play (seasonal)",
      "Wide valley views"
    ],
    images: [
      "https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1200&q=70",
      "https://images.unsplash.com/photo-1482192596544-9eb780fc7f66?auto=format&fit=crop&w=1200&q=70"
    ]
  }
};

const PACKAGES = [
  {
    id: "shimla-kufri-2d",
    district: "SHIMLA",
    name: "Shimla + Kufri (2 Days)",
    days: 2,
    tagline: "Classic hill station walk + nearby snow point (seasonal).",
    cover: "https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=600&q=70",
    itinerary: [
      { day: 1, places: ["shimla-mall-road"] },
      { day: 2, places: ["kufri"] }
    ]
  },
  {
    id: "manali-solang-2d",
    district: "KULLU",
    name: "Manali + Solang (2 Days)",
    days: 2,
    tagline: "Forest temple + adventure valley views.",
    cover: "https://images.unsplash.com/photo-1520975916090-3105956dac38?auto=format&fit=crop&w=600&q=70",
    itinerary: [
      { day: 1, places: ["manali-hidimba"] },
      { day: 2, places: ["solang"] }
    ]
  }
];

/* =========================================================
   UI HELPERS
========================================================= */
const $ = (id) => document.getElementById(id);
function toast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(toast._tmr);
  toast._tmr = setTimeout(()=>t.classList.remove("show"), 2400);
}
function fmtDate(d){
  const opt = { year:"numeric", month:"short", day:"2-digit" };
  return d.toLocaleDateString(undefined, opt);
}

/* =========================================================
   MAP
========================================================= */
let map, markersLayer, routeLayer;
function initMap(){
  map = L.map("map", { zoomControl:true }).setView([31.8, 77.3], 7);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap"
  }).addTo(map);

  markersLayer = L.layerGroup().addTo(map);
  routeLayer = L.polyline([], { weight: 4, opacity: 0.9 }).addTo(map);

  $("zoomHimachal").addEventListener("click", (e)=>{
    e.preventDefault();
    map.setView([31.85, 77.25], 7);
  });
  $("fitRoute").addEventListener("click", (e)=>{
    e.preventDefault();
    const latlngs = routeLayer.getLatLngs();
    if(latlngs.length){
      map.fitBounds(routeLayer.getBounds().pad(0.2));
    } else {
      toast("No route yet.");
    }
  });
}

/* =========================================================
   PACKAGES LIST
========================================================= */
let selectedDistrict = "ALL";
let selectedPackageId = null;

function buildDistricts(){
  const districts = ["ALL", ...Array.from(new Set(PACKAGES.map(p=>p.district)))].sort();
  const bar = $("districtBar");
  bar.innerHTML = "";
  districts.forEach(d=>{
    const el = document.createElement("div");
    el.className = "distItem" + (d===selectedDistrict ? " active":"");
    el.innerHTML = `<b>${d}</b>`;
    el.onclick = ()=>{
      selectedDistrict = d;
      $("pillDistrict").textContent = d;
      buildDistricts();
      renderPackages();
    };
    bar.appendChild(el);
  });
}

function renderPackages(){
  const list = $("pkgList");
  list.innerHTML = "";

  const shown = PACKAGES.filter(p => selectedDistrict==="ALL" ? true : p.district===selectedDistrict);
  $("pkgCount").textContent = `${shown.length} packages`;

  // group header
  const hdr = document.createElement("div");
  hdr.className = "pkgGroupHdr";
  hdr.innerHTML = `<div class="h1">Available Packages</div>
                   <div class="h2">Select a package to load day-wise (date-wise) itinerary and map pins.</div>`;
  list.appendChild(hdr);

  shown.forEach(pkg=>{
    const el = document.createElement("div");
    el.className = "pkg" + (pkg.id===selectedPackageId ? " active":"");
    el.innerHTML = `
      <div class="pkgPic">${pkg.cover ? `<img src="${pkg.cover}" alt="">` : "HE"}</div>
      <div class="pkgBody">
        <div class="pkgName">${pkg.name}</div>
        <div class="pkgMeta">${pkg.district} • ${pkg.days} Days</div>
        <div class="diffLine">${pkg.tagline}</div>
      </div>
    `;
    el.onclick = ()=> selectPackage(pkg.id);
    list.appendChild(el);
  });
}

/* =========================================================
   ITINERARY (DAY-WISE + DATE-WISE)
   ✅ "All places must be visible with respect to the date"
   - If user selects a trip start date, we show Day 1 -> that date, Day 2 -> next date, etc.
   ✅ Clicking a place opens a popup with details
========================================================= */

function selectPackage(pkgId){
  selectedPackageId = pkgId;
  $("pillSelected").textContent = pkgId ? "YES" : "None";
  renderPackages();

  const pkg = PACKAGES.find(p=>p.id===pkgId);
  if(!pkg) return;

  $("itiHint").textContent = "Day-wise itinerary";
  $("itiTitle").textContent = pkg.name;
  $("itiSub").textContent = `District: ${pkg.district} • ${pkg.days} Days • Click any place to see details.`;

  // Stats
  const totalPlaces = pkg.itinerary.reduce((sum,d)=>sum + d.places.length, 0);
  $("statDays").textContent = String(pkg.itinerary.length);
  $("statPlaces").textContent = String(totalPlaces);

  renderItinerary(pkg);
  renderMapPinsForPackage(pkg);
}

function renderItinerary(pkg){
  const daysWrap = $("daysList");
  daysWrap.innerHTML = "";

  const tripDateVal = $("tripDate").value;
  const startDate = tripDateVal ? new Date(tripDateVal + "T00:00:00") : null;

  pkg.itinerary.forEach((dayObj, idx)=>{
    const card = document.createElement("div");
    card.className = "dayCard";

    const dateTag = startDate ? fmtDate(new Date(startDate.getTime() + idx*86400000)) : "Select Start Date";
    card.innerHTML = `
      <div class="dayTop">
        <div class="d">Day ${dayObj.day}</div>
        <div class="dateTag">${dateTag}</div>
      </div>
      <div class="muted">All places for this day are listed below.</div>
    `;

    // Places list (always visible)
    dayObj.places.forEach(placeId=>{
      const place = PLACES[placeId];
      if(!place) return;

      const line = document.createElement("div");
      line.className = "placeLine";
      const thumbUrl = (place.images && place.images[0]) ? place.images[0] : "";
      line.innerHTML = `
        <div class="thumb">${thumbUrl ? `<img src="${thumbUrl}" alt="">` : place.name.slice(0,1)}</div>
        <div class="pinfo">
          <div class="pname">${place.name}</div>
          <div class="pmeta">${place.district} • Tap for details</div>
        </div>
      `;

      line.onclick = ()=> openPlaceModal(placeId, { day: dayObj.day, dateTag });
      card.appendChild(line);
    });

    daysWrap.appendChild(card);
  });
}

/* =========================================================
   PLACE MODAL (POPUP)
========================================================= */
let modalImgIndex = 0;
let modalImages = [];
let modalPlaceId = null;

function openPlaceModal(placeId, ctx){
  const place = PLACES[placeId];
  if(!place) return;

  modalPlaceId = placeId;
  modalImages = Array.isArray(place.images) && place.images.length ? place.images : [""];
  modalImgIndex = 0;

  $("modalTitle").textContent = place.name;
  $("modalAbout").textContent = place.history || "—";

  // bullets
  const ul = $("modalBullets");
  ul.innerHTML = "";
  (place.whatYouFind || []).forEach(x=>{
    const li = document.createElement("li");
    li.textContent = x;
    ul.appendChild(li);
  });
  if(!place.whatYouFind || !place.whatYouFind.length){
    const li = document.createElement("li");
    li.textContent = "Details not available yet.";
    ul.appendChild(li);
  }

  $("modalMeta").textContent =
    `District: ${place.district || "—"} • Lat: ${place.lat ?? "—"} • Lng: ${place.lng ?? "—"} • Day: ${ctx?.day ?? "—"} • Date: ${ctx?.dateTag ?? "—"}`;

  renderModalImage();
  $("placeModal").classList.add("show");
  $("placeModal").setAttribute("aria-hidden", "false");
}

function closePlaceModal(){
  $("placeModal").classList.remove("show");
  $("placeModal").setAttribute("aria-hidden", "true");
}

function renderModalImage(){
  const src = modalImages[modalImgIndex] || "";
  $("modalImg").src = src || "https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1200&q=70";

  // dots
  const dots = $("imgDots");
  dots.innerHTML = "";
  if(modalImages.length <= 1){
    dots.style.display = "none";
  } else {
    dots.style.display = "flex";
    modalImages.forEach((_, i)=>{
      const d = document.createElement("div");
      d.className = "dot" + (i===modalImgIndex ? " active":"");
      d.onclick = ()=>{ modalImgIndex=i; renderModalImage(); };
      dots.appendChild(d);
    });
  }

  // show/hide arrows
  const showArrows = modalImages.length > 1;
  $("imgPrev").style.display = showArrows ? "block" : "none";
  $("imgNext").style.display = showArrows ? "block" : "none";
}

/* =========================================================
   MAP PINS FOR CURRENT PACKAGE
========================================================= */
function renderMapPinsForPackage(pkg){
  markersLayer.clearLayers();
  routeLayer.setLatLngs([]);

  // collect unique places in package
  const placeIds = Array.from(new Set(pkg.itinerary.flatMap(d => d.places)));
  const latlngs = [];

  placeIds.forEach(pid=>{
    const p = PLACES[pid];
    if(!p || typeof p.lat !== "number" || typeof p.lng !== "number") return;

    const ll = [p.lat, p.lng];
    latlngs.push(ll);

    const m = L.marker(ll).addTo(markersLayer);
    m.bindPopup(`<b>${p.name}</b><br>${p.district || ""}<br><small>Tap to open details</small>`);
    m.on("click", ()=> openPlaceModal(pid, { day:"—", dateTag:"—" }));
  });

  if(latlngs.length){
    routeLayer.setLatLngs(latlngs);
    map.fitBounds(L.latLngBounds(latlngs).pad(0.25));
    $("mapStatus").textContent = `Pins: ${latlngs.length}`;
  } else {
    $("mapStatus").textContent = "No pins";
  }
}

/* =========================================================
   EVENTS
========================================================= */
function init(){
  // set default trip date = today
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth()+1).padStart(2,"0");
  const dd = String(now.getDate()).padStart(2,"0");
  $("tripDate").value = `${yyyy}-${mm}-${dd}`;

  initMap();
  buildDistricts();
  renderPackages();
  $("pillDistrict").textContent = selectedDistrict;

  $("generateBtn").addEventListener("click", ()=>{
    if(!selectedPackageId){
      toast("Select a package first.");
      return;
    }
    const pkg = PACKAGES.find(p=>p.id===selectedPackageId);
    if(pkg){
      renderItinerary(pkg);
      toast("Itinerary updated date-wise.");
    }
  });

  $("resetBtn").addEventListener("click", ()=>{
    $("startPoint").value = "Delhi";
    $("persons").value = 2;
    // keep date as-is
    toast("Reset done.");
  });

  $("chipHelp").addEventListener("click", ()=>{
    toast("Select a package → Day-wise places appear. Set Trip Start Date → dates update. Tap any place → popup details.");
  });

  $("chipClear").addEventListener("click", ()=>{
    selectedPackageId = null;
    $("pillSelected").textContent = "None";
    $("itiHint").textContent = "Select a package";
    $("itiTitle").textContent = "No package selected";
    $("itiSub").textContent = "Choose a package from the left to see day-wise places (date-wise).";
    $("statDays").textContent = "—";
    $("statPlaces").textContent = "—";
    $("daysList").innerHTML = "";
    markersLayer.clearLayers();
    routeLayer.setLatLngs([]);
    $("mapStatus").textContent = "Ready";
    renderPackages();
    toast("Selection cleared.");
  });

  // modal controls
  $("modalClose").addEventListener("click", closePlaceModal);
  $("placeModal").addEventListener("click", (e)=>{
    if(e.target.id === "placeModal") closePlaceModal();
  });
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") closePlaceModal();
  });

  $("imgPrev").addEventListener("click", ()=>{
    if(modalImages.length <= 1) return;
    modalImgIndex = (modalImgIndex - 1 + modalImages.length) % modalImages.length;
    renderModalImage();
  });
  $("imgNext").addEventListener("click", ()=>{
    if(modalImages.length <= 1) return;
    modalImgIndex = (modalImgIndex + 1) % modalImages.length;
    renderModalImage();
  });

  // Re-render itinerary when date changes (date-wise requirement)
  $("tripDate").addEventListener("change", ()=>{
    if(!selectedPackageId) return;
    const pkg = PACKAGES.find(p=>p.id===selectedPackageId);
    if(pkg) renderItinerary(pkg);
  });
}

init();
</script>
</body>
</html>