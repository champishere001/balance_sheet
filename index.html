<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Himachal Explorer</title>
  <style>
    :root{--bg:#070B15;--text:#ECF2FF;--muted:rgba(236,242,255,.78);--stroke:rgba(255,255,255,.12);--panel:rgba(255,255,255,.07);--brand:#FF7A18;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    .app{display:flex;min-height:100vh}
    .side{width:30%;min-width:310px;max-width:460px;border-right:1px solid var(--stroke);background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));padding:14px;overflow:auto}
    .main{flex:1;min-width:0;padding:14px}
    .brand{display:flex;gap:10px;align-items:center;padding:10px;border-radius:16px;border:1px solid var(--stroke);background:rgba(0,0,0,.22)}
    .dot{width:12px;height:12px;border-radius:50%;background:var(--brand);box-shadow:0 0 18px rgba(255,122,24,.75)}
    .title{font-weight:950}
    .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .btnRow{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .btn{border:0;cursor:pointer;padding:10px 12px;border-radius:14px;font-weight:950;color:#0b1220;background:linear-gradient(135deg,var(--brand),#ff9a4a)}
    .btnGhost{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);color:var(--text)}
    .hero{border-radius:24px;border:1px solid var(--stroke);overflow:hidden;background:rgba(255,255,255,.06)}
    .heroTop{padding:14px;background:rgba(0,0,0,.22);border-bottom:1px solid rgba(255,255,255,.10)}
    .heroTop h1{margin:0;font-size:clamp(22px,3.2vw,40px)}
    .heroTop p{margin:6px 0 0;color:rgba(236,242,255,.86);line-height:1.45}
    .carousel{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;padding:14px}
    .ph{height:120px;border-radius:18px;border:1px solid rgba(255,255,255,.12);background-size:cover;background-position:center}
    .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:0 14px 14px}
    .card{border-radius:18px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.16);padding:10px}
    .card b{display:block;font-size:18px}
    .card small{display:block;margin-top:2px;color:var(--muted);font-weight:900}
    .list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
    .d{border-radius:16px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);padding:10px;cursor:pointer}
    .d b{display:block}
    .d small{color:var(--muted);font-weight:900;line-height:1.35}
    @media(max-width:980px){.app{display:block}.side{width:auto;max-width:none;border-right:0;border-bottom:1px solid var(--stroke)}.carousel{grid-template-columns:repeat(3,1fr)}.stats{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="side">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <div class="title">Himachal Explorer</div>
          <div class="sub">District-wise places • treks • temples • lakes • hotels</div>
        </div>
      </div>

      <div class="btnRow">
        <button class="btn" onclick="location.href='map.html'">Open Master Map</button>
        <button class="btn btnGhost" onclick="location.href='admin.html'">Open Admin</button>
      </div>

      <div class="list" id="districtList">
        <div class="d"><b>Loading districts…</b><small>Please wait</small></div>
      </div>
    </aside>

    <main class="main">
      <section class="hero">
        <div class="heroTop">
          <h1>Himachal Pradesh</h1>
          <p>Explore the state by district. Use the Master Map for live distance & routes, and the Admin panel to publish new places.</p>
        </div>

        <div class="carousel">
          <div class="ph" style="background-image:url('https://source.unsplash.com/1200x800/?Himachal,Mountains')"></div>
          <div class="ph" style="background-image:url('https://source.unsplash.com/1200x800/?Spiti,Monastery')"></div>
          <div class="ph" style="background-image:url('https://source.unsplash.com/1200x800/?Manali,Snow')"></div>
          <div class="ph" style="background-image:url('https://source.unsplash.com/1200x800/?Dharamshala,Monastery')"></div>
          <div class="ph" style="background-image:url('https://source.unsplash.com/1200x800/?Dalhousie,Hills')"></div>
          <div class="ph" style="background-image:url('https://source.unsplash.com/1200x800/?Himachal,Lake')"></div>
        </div>

        <div class="stats">
          <div class="card"><b id="sDistricts">—</b><small>Districts</small></div>
          <div class="card"><b id="sPins">—</b><small>Total Records</small></div>
          <div class="card"><b id="sGeo">—</b><small>With lat/lng</small></div>
          <div class="card"><b>Map + Admin</b><small>Live distance + publish</small></div>
        </div>
      </section>
    </main>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    // ✅ PASTE SAME CONFIG HERE (same in admin.html & map.html)
    const firebaseConfig = {
      apiKey: "PASTE_API_KEY",
      authDomain: "revnue-records.firebaseapp.com",
      databaseURL: "https://revnue-records-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "revnue-records",
      storageBucket: "revnue-records.appspot.com",
      messagingSenderId: "PASTE_SENDER_ID",
      appId: "PASTE_APP_ID",
      measurementId: "PASTE_MEASUREMENT_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const ROOT = "tourism/hp/districts";
    const listEl = document.getElementById("districtList");

    const sDistricts = document.getElementById("sDistricts");
    const sPins = document.getElementById("sPins");
    const sGeo = document.getElementById("sGeo");

    const safeObj = (x)=> (x && typeof x==="object") ? x : {};

    function countSegments(seg){
      seg = safeObj(seg);
      const types = ["destinations","lakes","temples","treks","hotels"];
      let total=0, geo=0;
      for(const t of types){
        const node = safeObj(seg[t]);
        for(const id of Object.keys(node)){
          total++;
          const it = node[id]||{};
          if(it.lat!=null && it.lng!=null && it.lat!=="" && it.lng!=="") geo++;
        }
      }
      return {total, geo};
    }

    async function load(){
      const snap = await get(ref(db, ROOT));
      const root = snap.exists() ? snap.val() : {};
      const districts = Object.keys(safeObj(root)).sort((a,b)=>a.localeCompare(b));

      let totalPins=0, geoPins=0;

      listEl.innerHTML = districts.map(d=>{
        const dn = root[d]||{};
        const counts = dn.counts || {};
        const c = {
          destinations: counts.destinations ?? 0,
          lakes: counts.lakes ?? 0,
          temples: counts.temples ?? 0,
          treks: counts.treks ?? 0,
          hotels: counts.hotels ?? 0
        };
        const sum = c.destinations + c.lakes + c.temples + c.treks + c.hotels;

        const segCount = countSegments(dn.segments);
        totalPins += segCount.total;
        geoPins += segCount.geo;

        return `
          <div class="d" onclick="location.href='map.html#district=${encodeURIComponent(d)}'">
            <b>${d}</b>
            <small>${sum} items • Dest ${c.destinations} • Lakes ${c.lakes} • Temples ${c.temples} • Treks ${c.treks} • Hotels ${c.hotels}</small>
          </div>
        `;
      }).join("");

      sDistricts.textContent = districts.length;
      sPins.textContent = totalPins;
      sGeo.textContent = geoPins;
    }

    load().catch(()=>{ listEl.innerHTML = `<div class="d"><b>Firebase not configured</b><small>Paste firebaseConfig in all pages</small></div>`; });
  </script>
</body>
</html>