<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Place ‚Äî HP Tourism</title>
  <link rel="stylesheet" href="assets/style.css" />

  <!-- Leaflet (OpenStreetMap) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <div class="topbar">
    <div class="inner">
      <a class="brand" href="index.html"><div class="logo"></div><div>HP Tourism Portal</div></a>
      <div class="nav">
        <a href="index.html">Home</a>
        <a href="districts.html">Districts</a>
        <a href="packages.html">Packages</a>
        <a href="hotels.html">Hotels</a>
        <a href="temples.html">Temples</a>
        <a href="treks.html">Treks</a>
        <a href="routes.html">Routes</a>
        <a href="admin.html">Admin</a>
      </div>
    </div>
  </div>

  <div class="container" id="placeWrap">
    <div class="detailHead">
      <div class="detailHero">
        <img id="placeHeroImg" alt="Place"/>
        <div class="detailOverlay">
          <div>
            <h1 id="placeTitle">Place</h1>
            <div class="sub" id="placeSub"></div>
          </div>
        </div>
      </div>

      <div class="detailBody">
        <!-- LEFT -->
        <div class="panel">
          <h3>Overview</h3>
          <div id="placeDesc" class="note"></div>

          <div class="divider"></div>
          <div class="kv">
            <div class="item"><b>Best time</b><span id="bestTime">-</span></div>
            <div class="item"><b>Distance (demo)</b><span id="approxKm">-</span></div>
          </div>

          <div class="divider"></div>
          <h3>Highlights</h3>
          <div id="highlights" class="pills"></div>

          <div class="divider"></div>
          <h3>Nearby</h3>
          <div id="nearby" class="pills"></div>

          <div class="divider"></div>
          <h3>Explore inside this place</h3>
          <div class="tabs">
            <div class="tab active" data-tab="hotels">üè® Hotels</div>
            <div class="tab" data-tab="temples">üõï Temples</div>
            <div class="tab" data-tab="treks">ü•æ Treks</div>
            <div class="tab" data-tab="gallery">üì∑ Gallery</div>
          </div>

          <div id="tabContent"></div>
        </div>

        <!-- RIGHT -->
        <div class="panel">
          <h3>Map (OpenStreetMap)</h3>
          <div class="note">No API key needed. Location pin is from data.js coordinates.</div>
          <div class="divider"></div>
          <div id="placeMap" class="mapBox"></div>

          <div class="divider"></div>
          <h3>Route + Expenditure (Demo)</h3>
          <div class="note">Enter values to estimate total cost.</div>

          <div class="divider"></div>
          <div class="formRow">
            <div class="input">
              <div style="width:100%">
                <label>Fuel cost (‚Çπ/L)</label>
                <input id="fuelCost" type="number" value="105" />
              </div>
            </div>
            <div class="input">
              <div style="width:100%">
                <label>Mileage (km/L)</label>
                <input id="kmpl" type="number" value="14" />
              </div>
            </div>
            <div class="input">
              <div style="width:100%">
                <label>Toll / Parking (‚Çπ)</label>
                <input id="toll" type="number" value="300" />
              </div>
            </div>
            <div class="input">
              <div style="width:100%">
                <label>Days</label>
                <input id="days" type="number" value="2" />
              </div>
            </div>
          </div>

          <div class="input" style="margin-top:10px;">
            <div style="width:100%">
              <label>Stay + Food per day (‚Çπ)</label>
              <input id="perDay" type="number" value="1500" />
            </div>
          </div>

          <div style="display:flex; gap:10px; margin-top:10px;">
            <button class="btn" id="calcBtn">Calculate</button>
            <a class="btn ghost" href="routes.html">Open Routes Page</a>
          </div>

          <div class="divider"></div>
          <div id="calcOut" class="note">Click <b>Calculate</b> to see breakdown.</div>
        </div>
      </div>
    </div>

    <div class="footer">Premium detail page: tabs + map + calculator + gallery lightbox.</div>
  </div>

  <!-- LIGHTBOX -->
  <div id="lightbox" class="lightbox hidden">
    <div class="frame">
      <div class="top">
        <b id="lightboxTitle">Gallery</b>
        <button id="lightboxClose">‚úï</button>
      </div>
      <img id="lightboxImg" alt="Preview"/>
    </div>
  </div>

  <script src="assets/data.js"></script>
  <script src="assets/ui.js"></script>
  <script src="assets/map.js"></script>
  <script src="assets/gallery.js"></script>
  <script src="assets/app.js"></script>

  <script>
    // Extend place page to render map + lightbox gallery
    (function(){
      const _initPlace = App.initPlace;
      App.initPlace = function(){
        _initPlace();

        const id = UI.getParam("id");
        const item = HP_DATA.items.find(x=>x.id===id && x.type==="place");
        if(!item) return;

        // MAP
        const center = item.coords || [31.5, 77.2];
        const map = MapUI.createMap("placeMap", center, item.coords ? 12 : 8);
        if(item.coords) MapUI.addMarker(map, item.coords, item.name);

        // GALLERY lightbox (when tab is gallery, make cards clickable)
        const originalRender = document.getElementById("tabContent").innerHTML;
        // Hook after clicking Gallery tab: delegate click on images
        document.addEventListener("click", (e)=>{
          const img = e.target.closest("[data-gallery-img]");
          if(!img) return;
          const list = JSON.parse(img.dataset.galleryList || "[]");
          const idx = Number(img.dataset.galleryIndex || 0);
          Gallery.open(list, idx, item.name);
        });

        // Patch gallery tab rendering by overriding when it appears
        const tabs = document.querySelectorAll(".tab");
        tabs.forEach(t=>{
          t.addEventListener("click", ()=>{
            if(t.dataset.tab !== "gallery") return;
            const list = [
              item.img,
              "https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1600&q=70",
              "https://images.unsplash.com/photo-1526481280695-3c687fd5432c?auto=format&fit=crop&w=1600&q=70"
            ];
            const wrap = document.getElementById("tabContent");
            wrap.innerHTML = `
              <div class="cards">
                ${list.map((u,i)=>`
                  <div class="card" style="cursor:pointer;">
                    <div class="img">
                      <img src="${u}" alt="Gallery" data-gallery-img="1"
                           data-gallery-index="${i}"
                           data-gallery-list='${JSON.stringify(list)}' />
                    </div>
                    <div class="body"><p>Tap photo to open full preview.</p></div>
                  </div>
                `).join("")}
              </div>`;
          });
        });
      };
    })();

    App.initPlace();
  </script>
</body>
</html>
